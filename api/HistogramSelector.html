<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">
  <title>HistogramSelector | ParaViewWeb</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Canonical links -->
  <link rel="canonical" href="https://kitware.github.io/paraviewweb/api/HistogramSelector.html">
  <!-- Alternative links -->
  
    
      <link rel="alternative" hreflang="en" href="https://kitware.github.io/paraviewweb/api/HistogramSelector.html">
    
  
  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/paraviewweb/icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/paraviewweb/icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/paraviewweb/icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/paraviewweb/icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/paraviewweb/icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/paraviewweb/icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/paraviewweb/icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/paraviewweb/icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/paraviewweb/icon/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/paraviewweb/icon/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/paraviewweb/icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/paraviewweb/icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/paraviewweb/icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/paraviewweb/icon/mstile-144x144.png">
  <!-- CSS -->
  <!-- build:css build/css/navy.css -->
  <link rel="stylesheet" href="/paraviewweb/css/navy.css">
  <!-- endbuild -->
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css">
  <!-- RSS -->
  <link rel="alternate" href="/paraviewweb/atom.xml" title="ParaViewWeb">
  <!-- Open Graph -->
  <meta name="description" content="SourceScore.jsimport d3 from &apos;d3&apos;;/* eslint-disable import/no-unresolved */import style from &apos;PVWStyle/InfoVizNative/HistogramSelector.mcss&apos;;/* eslint-enable import/no-unresolved */let publicAPI = nul">
<meta property="og:type" content="website">
<meta property="og:title" content="HistogramSelector">
<meta property="og:url" content="https://kitware.github.io/paraviewweb/api/HistogramSelector.html">
<meta property="og:site_name" content="ParaViewWeb">
<meta property="og:description" content="SourceScore.jsimport d3 from &apos;d3&apos;;/* eslint-disable import/no-unresolved */import style from &apos;PVWStyle/InfoVizNative/HistogramSelector.mcss&apos;;/* eslint-enable import/no-unresolved */let publicAPI = nul">
<meta property="og:updated_time" content="2016-07-19T21:41:51.674Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HistogramSelector">
<meta name="twitter:description" content="SourceScore.jsimport d3 from &apos;d3&apos;;/* eslint-disable import/no-unresolved */import style from &apos;PVWStyle/InfoVizNative/HistogramSelector.mcss&apos;;/* eslint-enable import/no-unresolved */let publicAPI = nul">
  <!-- Google Analytics -->
  
</head>

<body>
  <div id="container">
    <header id="header" class="wrapper">
  <div id="header-inner" class="inner">
    <h1 id="logo-wrap">
      <a href="/paraviewweb/" id="logo">ParaViewWeb</a>
    </h1>
    <nav id="main-nav">
      <a href="/paraviewweb/docs/" class="main-nav-link">Docs</a><a href="/paraviewweb/api/" class="main-nav-link">API</a><a href="/paraviewweb/examples/" class="main-nav-link">Examples</a><a href="/paraviewweb/applications/" class="main-nav-link">Applications</a>
      <a href="https://github.com/kitware/paraviewweb" class="main-nav-link"><i class="fa fa-github-alt"></i></a>
      <div id="search-input-wrap">
        <div id="search-input-icon">
          <i class="fa fa-search"></i>
        </div>
        <input type="search" id="search-input" placeholder="Search...">
      </div>
    </nav>
    <a id="mobile-nav-toggle">
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
    </a>
  </div>
</header>

    <div id="content-wrap">
  <div id="content" class="wrapper">
    <div id="content-inner">
      <article class="article-container" itemscope itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
            <div class="inner">
              <header class="article-header">
                <h1 class="article-title" itemprop="name">HistogramSelector</h1>
              </header>
              <div class="article-content" itemprop="articleBody">
                <h1 id="Source" class="article-heading"><a href="#Source" class="headerlink" title="Source"></a>Source<a class="article-anchor" href="#Source" aria-hidden="true"></a></h1><figure class="highlight"><figcaption><span>Score.js</span></figcaption><table><tr><td class="code"><pre><div class="line">import d3 from 'd3';</div><div class="line">/* eslint-disable import/no-unresolved */</div><div class="line">import style from 'PVWStyle/InfoVizNative/HistogramSelector.mcss';</div><div class="line">/* eslint-enable import/no-unresolved */</div><div class="line"></div><div class="line">let publicAPI = null;</div><div class="line">let model = null;</div><div class="line">let displayOnlyScored = false;</div><div class="line">let scorePopupDiv = null;</div><div class="line">let dividerPopupDiv = null;</div><div class="line"></div><div class="line">export function init(inPublicAPI, inModel) &#123;</div><div class="line">  publicAPI = inPublicAPI;</div><div class="line">  model = inModel;</div><div class="line">&#125;</div><div class="line"></div><div class="line">const scoredHeaderClick = (d) =&gt; &#123;</div><div class="line">  displayOnlyScored = !displayOnlyScored;</div><div class="line">  publicAPI.render();</div><div class="line">&#125;;</div><div class="line"></div><div class="line">export function getDisplayOnlyScored() &#123;</div><div class="line">  return displayOnlyScored;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function createGroups(svgGr) &#123;</div><div class="line">  // scoring interface background group, must be behind.</div><div class="line">  svgGr.insert('g', ':first-child')</div><div class="line">    .classed(style.jsScoreBackground, true);</div><div class="line">  svgGr.append('g')</div><div class="line">    .classed(style.score, true);</div><div class="line">  svgGr.append('rect')</div><div class="line">    .classed(style.overlay, true)</div><div class="line">    .style('cursor', 'default');</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function createHeader(header) &#123;</div><div class="line">  if (typeof model.scores !== 'undefined') &#123;</div><div class="line">    header.append('span')</div><div class="line">      .on('click', scoredHeaderClick)</div><div class="line">      .append('i')</div><div class="line">      .classed(style.jsScoredIcon, true);</div><div class="line">    header.append('span')</div><div class="line">      .classed(style.jsScoredHeader, true)</div><div class="line">      .text('Only Scored')</div><div class="line">      .on('click', scoredHeaderClick);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function updateHeader() &#123;</div><div class="line">  if (typeof model.scores !== 'undefined') &#123;</div><div class="line">    d3.select(`.$&#123;style.jsScoredIcon&#125;`)</div><div class="line">      // apply class - 'false' should come first to not remove common base class.</div><div class="line">      .classed(getDisplayOnlyScored() ? style.allScoredIcon : style.onlyScoredIcon, false)</div><div class="line">      .classed(!getDisplayOnlyScored() ? style.allScoredIcon : style.onlyScoredIcon, true);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function createDefaultDivider(val, uncert) &#123;</div><div class="line">  return &#123;</div><div class="line">    value: val,</div><div class="line">    uncertainty: uncert,</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function createDragDivider(hitIndex, val, def, hobj) &#123;</div><div class="line">  let dragD = null;</div><div class="line">  if (hitIndex &gt;= 0) &#123;</div><div class="line">    // start modifying existing divider</div><div class="line">    // it becomes a temporary copy if we go outside our bounds</div><div class="line">    dragD = &#123; index: hitIndex,</div><div class="line">              newDivider: createDefaultDivider(undefined, def.dividers[hitIndex].uncertainty),</div><div class="line">              low: (hitIndex === 0 ? hobj.min : def.dividers[hitIndex - 1].value),</div><div class="line">              high: (hitIndex === def.dividers.length - 1 ? hobj.max : def.dividers[hitIndex + 1].value),</div><div class="line">            &#125;;</div><div class="line">  &#125; else &#123;</div><div class="line">    // create a temp divider to render.</div><div class="line">    dragD = &#123; index: -1,</div><div class="line">              newDivider: createDefaultDivider(val, 0),</div><div class="line">              low: hobj.min,</div><div class="line">              high: hobj.max,</div><div class="line">            &#125;;</div><div class="line">  &#125;</div><div class="line">  return dragD;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function moveDragDivider(val, def) &#123;</div><div class="line">  if (def.dragDivider.index &gt;= 0) &#123;</div><div class="line">    // if we drag outside our bounds, make this a 'temporary' extra divider.</div><div class="line">    if (val &lt; def.dragDivider.low) &#123;</div><div class="line">      def.dragDivider.newDivider.value = val;</div><div class="line">      def.dividers[def.dragDivider.index].value = def.dragDivider.low;</div><div class="line">      def.dividers[def.dragDivider.index].uncertainty = 0;</div><div class="line">    &#125; else if (val &gt; def.dragDivider.high) &#123;</div><div class="line">      def.dragDivider.newDivider.value = val;</div><div class="line">      def.dividers[def.dragDivider.index].value = def.dragDivider.high;</div><div class="line">      def.dividers[def.dragDivider.index].uncertainty = 0;</div><div class="line">    &#125; else &#123;</div><div class="line">      def.dividers[def.dragDivider.index].value = val;</div><div class="line">      def.dividers[def.dragDivider.index].uncertainty = def.dragDivider.newDivider.uncertainty;</div><div class="line">      def.dragDivider.newDivider.value = undefined;</div><div class="line">    &#125;</div><div class="line">  &#125; else &#123;</div><div class="line">    def.dragDivider.newDivider.value = val;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// create a sorting helper method, to sort dividers based on div.value</div><div class="line">// D3 bug: just an accessor didn't work - must use comparator function</div><div class="line">const bisectDividers = d3.bisector((a, b) =&gt; (a.value - b.value)).left;</div><div class="line"></div><div class="line">// where are we (to the left of) in the divider list?</div><div class="line">// Did we hit one?</div><div class="line">export function dividerPick(overCoords, def, marginPx, minVal) &#123;</div><div class="line">  const val = def.xScale.invert(overCoords[0]);</div><div class="line">  const index = bisectDividers(def.dividers, createDefaultDivider(val));</div><div class="line">  let hitIndex = -1;</div><div class="line">  if (def.dividers.length &gt; 0) &#123;</div><div class="line">    if (index === 0) &#123;</div><div class="line">      hitIndex = 0;</div><div class="line">    &#125; else if (index === def.dividers.length) &#123;</div><div class="line">      hitIndex = index - 1;</div><div class="line">    &#125; else &#123;</div><div class="line">      hitIndex = (def.dividers[index].value - val &lt; val - def.dividers[index - 1].value ? index : index - 1);</div><div class="line">    &#125;</div><div class="line">    const margin = def.xScale.invert(marginPx) - minVal;</div><div class="line">    if (Math.abs(def.dividers[hitIndex].value - val) &gt; margin) &#123;</div><div class="line">      // we weren't close enough...</div><div class="line">      hitIndex = -1;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  return [val, index, hitIndex];</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function regionPick(overCoords, def, hobj) &#123;</div><div class="line">  if (def.dividers.length === 0 || def.regions.length &lt;= 1) return 0;</div><div class="line">  const val = def.xScale.invert(overCoords[0]);</div><div class="line">  const hitIndex = bisectDividers(def.dividers, createDefaultDivider(val));</div><div class="line">  return hitIndex;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function finishDivider(def, hobj, forceDelete = false) &#123;</div><div class="line">  const val = def.dragDivider.newDivider.value;</div><div class="line">  // if val is defined, we moved an existing divider inside</div><div class="line">  // its region, and we just need to render. Otherwise...</div><div class="line">  if (val !== undefined || forceDelete) &#123;</div><div class="line">    // drag 30 pixels out of the hist to delete.</div><div class="line">    const dragOut = def.xScale.invert(30) - hobj.min;</div><div class="line">    if (forceDelete || val &lt; hobj.min - dragOut || val &gt; hobj.max + dragOut) &#123;</div><div class="line">      if (def.dragDivider.index &gt;= 0) &#123;</div><div class="line">        // delete a region.</div><div class="line">        if (forceDelete || def.dividers[def.dragDivider.index].value === def.dragDivider.high) &#123;</div><div class="line">          def.regions.splice(def.dragDivider.index + 1, 1);</div><div class="line">        &#125; else &#123;</div><div class="line">          def.regions.splice(def.dragDivider.index, 1);</div><div class="line">        &#125;</div><div class="line">        // console.log('del reg ', def.regions);</div><div class="line">        // delete the divider.</div><div class="line">        def.dividers.splice(def.dragDivider.index, 1);</div><div class="line">        // console.log('del div ', def.dividers);</div><div class="line">      &#125;</div><div class="line">    &#125; else &#123;</div><div class="line">      // if we moved a divider, delete the old region</div><div class="line">      if (def.dragDivider.index &gt;= 0) &#123;</div><div class="line">        if (def.dividers[def.dragDivider.index].value === def.dragDivider.low) &#123;</div><div class="line">          def.regions.splice(def.dragDivider.index, 1);</div><div class="line">        &#125; else &#123;</div><div class="line">          def.regions.splice(def.dragDivider.index + 1, 1);</div><div class="line">        &#125;</div><div class="line">        // console.log('del reg ', def.regions);</div><div class="line">        // delete the old divider</div><div class="line">        def.dividers.splice(def.dragDivider.index, 1);</div><div class="line">        // console.log('del div ', def.dividers);</div><div class="line">      &#125;</div><div class="line">      // add a new divider</div><div class="line">      def.dragDivider.newDivider.value = Math.min(hobj.max, Math.max(hobj.min, val));</div><div class="line">      // find the index based on dividers sorted by divider.value</div><div class="line">      const index = bisectDividers(def.dividers, def.dragDivider.newDivider);</div><div class="line">      def.dividers.splice(index, 0, def.dragDivider.newDivider);</div><div class="line">      // console.log('add div ', index, def.dividers);</div><div class="line">      // add a new region, copies the score of existing region.</div><div class="line">      def.regions.splice(index, 0, def.regions[index]);</div><div class="line">      // console.log('add reg ', index, def.regions);</div><div class="line">    &#125;</div><div class="line">  &#125; else &#123;</div><div class="line">    if (def.dragDivider.index &gt;= 0) &#123;</div><div class="line">      def.dividers[def.dragDivider.index].uncertainty = def.dragDivider.newDivider.uncertainty;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  def.dragDivider = undefined;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function positionPopup(popupDiv, left, top) &#123;</div><div class="line">  const clientRect = model.listContainer.getBoundingClientRect();</div><div class="line">  const popupRect = popupDiv.node().getBoundingClientRect();</div><div class="line">  if (popupRect.width + left &gt; clientRect.width) &#123;</div><div class="line">    popupDiv.style('left', 'auto');</div><div class="line">    popupDiv.style('right', 0);</div><div class="line">  &#125; else &#123;</div><div class="line">    popupDiv.style('right', null);</div><div class="line">    popupDiv.style('left', `$&#123;left&#125;px`);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  if (popupRect.height + top &gt; clientRect.height) &#123;</div><div class="line">    popupDiv.style('top', 'auto');</div><div class="line">    popupDiv.style('bottom', 0);</div><div class="line">  &#125; else &#123;</div><div class="line">    popupDiv.style('bottom', null);</div><div class="line">    popupDiv.style('top', `$&#123;top&#125;px`);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function validateDividerVal(n) &#123;</div><div class="line">  // is it a finite float number?</div><div class="line">  return !isNaN(parseFloat(n)) &amp;&amp; isFinite(n);</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function showDividerPopup(dPopupDiv, selectedDef, hobj, coord) &#123;</div><div class="line">  const topMargin = 4;</div><div class="line">  const rowHeight = 13;</div><div class="line">  // 's' SI unit label won't work for a number entry field.</div><div class="line">  const formatter = d3.format('.4g');</div><div class="line"></div><div class="line">  dPopupDiv</div><div class="line">    .style('display', 'initial');</div><div class="line">  positionPopup(dPopupDiv, coord[0] - topMargin - 0.5 * rowHeight,</div><div class="line">                coord[1] + model.headerSize - topMargin - 1.7 * rowHeight);</div><div class="line"></div><div class="line">  const selDivider = selectedDef.dividers[selectedDef.dragDivider.index];</div><div class="line">  let savedVal = selDivider.value;</div><div class="line">  let savedUncert = selDivider.uncertainty;</div><div class="line">  dPopupDiv</div><div class="line">    .on('mouseleave', () =&gt; &#123;</div><div class="line">      if (selectedDef.dragDivider) &#123;</div><div class="line">        moveDragDivider(savedVal, selectedDef);</div><div class="line">        finishDivider(selectedDef, hobj);</div><div class="line">      &#125;</div><div class="line">      dPopupDiv</div><div class="line">        .style('display', 'none');</div><div class="line">      selectedDef.dragDivider = undefined;</div><div class="line">      publicAPI.render();</div><div class="line">    &#125;);</div><div class="line">  const valInput = dPopupDiv.select(`.$&#123;style.jsDividerValueInput&#125;`)</div><div class="line">    .attr('value', formatter(selDivider.value))</div><div class="line">    .property('value', formatter(selDivider.value))</div><div class="line">    .on('input', () =&gt; &#123;</div><div class="line">      // typing values, show feedback.</div><div class="line">      let val = d3.event.target.value;</div><div class="line">      if (!validateDividerVal(val)) val = savedVal;</div><div class="line">      moveDragDivider(val, selectedDef);</div><div class="line">      publicAPI.render(selectedDef.name);</div><div class="line">    &#125;)</div><div class="line">    .on('change', () =&gt; &#123;</div><div class="line">      // committed to a value, show feedback.</div><div class="line">      let val = d3.event.target.value;</div><div class="line">      if (!validateDividerVal(val)) val = savedVal;</div><div class="line">      else &#123;</div><div class="line">        val = Math.min(hobj.max, Math.max(hobj.min, val));</div><div class="line">        d3.event.target.value = val;</div><div class="line">        savedVal = val;</div><div class="line">      &#125;</div><div class="line">      moveDragDivider(val, selectedDef);</div><div class="line">      publicAPI.render(selectedDef.name);</div><div class="line">    &#125;)</div><div class="line">    .on('keyup', () =&gt; &#123;</div><div class="line">      // revert to last committed value</div><div class="line">      if (d3.event.key === 'Escape') &#123;</div><div class="line">        moveDragDivider(savedVal, selectedDef);</div><div class="line">        dPopupDiv.on('mouseleave')();</div><div class="line">      &#125; else if (d3.event.key === 'Enter' || d3.event.key === 'Return') &#123;</div><div class="line">        // commit current value</div><div class="line">        dPopupDiv.on('mouseleave')();</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  // initial select/focus so use can immediately change the value.</div><div class="line">  valInput.node().select();</div><div class="line">  valInput.node().focus();</div><div class="line"></div><div class="line">  dPopupDiv.select(`.$&#123;style.jsDividerUncertaintyInput&#125;`)</div><div class="line">    .attr('value', formatter(selDivider.uncertainty))</div><div class="line">    .property('value', formatter(selDivider.uncertainty))</div><div class="line">    .on('input', () =&gt; &#123;</div><div class="line">      // typing values, show feedback.</div><div class="line">      let uncert = d3.event.target.value;</div><div class="line">      if (!validateDividerVal(uncert)) uncert = savedUncert;</div><div class="line">      selectedDef.dragDivider.newDivider.uncertainty = uncert;</div><div class="line">      if (selectedDef.dragDivider.newDivider.value === undefined) selDivider.uncertainty = uncert;</div><div class="line">      publicAPI.render(selectedDef.name);</div><div class="line">    &#125;)</div><div class="line">    .on('change', () =&gt; &#123;</div><div class="line">      // committed to a value, show feedback.</div><div class="line">      let uncert = d3.event.target.value;</div><div class="line">      if (!validateDividerVal(uncert)) uncert = savedUncert;</div><div class="line">      else &#123;</div><div class="line">        // uncertainty is a %</div><div class="line">        uncert = Math.min(100, Math.max(0, uncert));</div><div class="line">        d3.event.target.value = uncert;</div><div class="line">        savedUncert = uncert;</div><div class="line">      &#125;</div><div class="line">      selectedDef.dragDivider.newDivider.uncertainty = uncert;</div><div class="line">      if (selectedDef.dragDivider.newDivider.value === undefined) selDivider.uncertainty = uncert;</div><div class="line">      publicAPI.render(selectedDef.name);</div><div class="line">    &#125;)</div><div class="line">    .on('keyup', () =&gt; &#123;</div><div class="line">      if (d3.event.key === 'Escape') &#123;</div><div class="line">        selectedDef.dragDivider.newDivider.uncertainty = savedUncert;</div><div class="line">        dPopupDiv.on('mouseleave')();</div><div class="line">      &#125; else if (d3.event.key === 'Enter' || d3.event.key === 'Return') &#123;</div><div class="line">        dPopupDiv.on('mouseleave')();</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line">// Divider editing popup allows changing its value or uncertainty, or deleting it.</div><div class="line">export function createDividerPopup() &#123;</div><div class="line">  const dPopupDiv = d3.select(model.listContainer).append('div')</div><div class="line">    .classed(style.dividerPopup, true)</div><div class="line">    .style('display', 'none');</div><div class="line">  const table = dPopupDiv.append('table');</div><div class="line">  const tr1 = table.append('tr');</div><div class="line">  tr1.append('td')</div><div class="line">    .text('Value:');</div><div class="line">  tr1.append('input')</div><div class="line">    .classed(style.jsDividerValueInput, true)</div><div class="line">    .attr('type', 'number')</div><div class="line">    .attr('step', 'any')</div><div class="line">    .style('width', '6em');</div><div class="line">  const tr2 = table.append('tr');</div><div class="line">  tr2.append('td')</div><div class="line">    .text('% Uncertainty:');</div><div class="line">  tr2.append('input')</div><div class="line">    .classed(style.jsDividerUncertaintyInput, true)</div><div class="line">    .attr('type', 'number')</div><div class="line">    .attr('step', 'any')</div><div class="line">    .style('width', '6em');</div><div class="line">  const tr3 = table.append('tr');</div><div class="line">  tr3.append('input')</div><div class="line">    .classed(style.scoreButton, true)</div><div class="line">    .attr('type', 'button')</div><div class="line">    .attr('value', 'Delete |')</div><div class="line">    .on('click', () =&gt; &#123;</div><div class="line">      const hobj = model.provider.getHistogram1D(model.selectedDef.name);</div><div class="line">      if (hobj !== null) finishDivider(model.selectedDef, hobj, true);</div><div class="line">      dPopupDiv</div><div class="line">        .style('display', 'none');</div><div class="line">      publicAPI.render();</div><div class="line">    &#125;);</div><div class="line">  return dPopupDiv;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function showScorePopup(sPopupDiv, coord, selRow) &#123;</div><div class="line">  // it seemed like a good idea to use getBoundingClientRect() to determine row height</div><div class="line">  // but it returns all zeros when the popup has been invisible...</div><div class="line">  const topMargin = 4;</div><div class="line">  const rowHeight = 13;</div><div class="line"></div><div class="line">  sPopupDiv</div><div class="line">    .style('display', 'initial');</div><div class="line">  positionPopup(sPopupDiv, coord[0] - topMargin - 0.5 * rowHeight,</div><div class="line">                coord[1] + model.headerSize - topMargin - (0.7 + selRow) * rowHeight);</div><div class="line"></div><div class="line">  sPopupDiv.selectAll(`.$&#123;style.jsScoreLabel&#125;`)</div><div class="line">    .style('background-color', (d, i) =&gt; &#123;</div><div class="line">      // use mostly-solid for selected, mostly-transparent when not selected.</div><div class="line">      const interp = d3.interpolateRgb('#fff', d.color);</div><div class="line">      return interp((i === selRow) ? 0.7 : 0.2);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function createScorePopup() &#123;</div><div class="line">  const sPopupDiv = d3.select(model.listContainer).append('div')</div><div class="line">    .classed(style.scorePopup, true)</div><div class="line">    .style('display', 'none')</div><div class="line">    .on('mouseleave', () =&gt; &#123;</div><div class="line">      sPopupDiv</div><div class="line">        .style('display', 'none');</div><div class="line">      model.selectedDef.dragDivider = undefined;</div><div class="line">    &#125;);</div><div class="line">  // create radio-buttons that allow choosing the score for the selected region</div><div class="line">  const scoreChoices = sPopupDiv.selectAll(`.$&#123;style.jsScoreChoice&#125;`)</div><div class="line">    .data(model.scores);</div><div class="line">  scoreChoices.enter()</div><div class="line">    .append('label')</div><div class="line">      .classed(style.scoreLabel, true)</div><div class="line">      .text((d) =&gt; d.name)</div><div class="line">    .append('input')</div><div class="line">      .classed(style.scoreChoice, true)</div><div class="line">      .attr('name', 'score_choice_rb')</div><div class="line">      .attr('type', 'radio')</div><div class="line">      .attr('value', (d) =&gt; (d.name))</div><div class="line">      .property('checked', (d, i) =&gt; (i === model.defaultScore))</div><div class="line">      .on('click', (d, i) =&gt; &#123;</div><div class="line">        // use click, not change, so we get notified even when current value is chosen.</div><div class="line">        const def = model.selectedDef;</div><div class="line">        def.regions[def.hitRegionIndex] = i;</div><div class="line">        def.dragDivider = undefined;</div><div class="line">        sPopupDiv</div><div class="line">          .style('display', 'none');</div><div class="line">        publicAPI.render();</div><div class="line">      &#125;);</div><div class="line">  // create a button for creating a new divider, so we don't require</div><div class="line">  // the invisible alt/ctrl click to create one.</div><div class="line">  sPopupDiv</div><div class="line">    .append('input')</div><div class="line">      .classed(style.scoreButton, true)</div><div class="line">      .attr('type', 'button')</div><div class="line">      .attr('value', 'New |')</div><div class="line">      .on('click', () =&gt; &#123;</div><div class="line">        const hobj = model.provider.getHistogram1D(model.selectedDef.name);</div><div class="line">        if (hobj !== null) finishDivider(model.selectedDef, hobj);</div><div class="line">        sPopupDiv</div><div class="line">          .style('display', 'none');</div><div class="line">        publicAPI.render();</div><div class="line">      &#125;);</div><div class="line">  return sPopupDiv;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function createPopups() &#123;</div><div class="line">  if (typeof model.scores !== 'undefined') &#123;</div><div class="line">    scorePopupDiv = d3.select(model.listContainer).select(`.$&#123;style.jsScorePopup&#125;`);</div><div class="line">    if (scorePopupDiv.empty()) &#123;</div><div class="line">      scorePopupDiv = createScorePopup();</div><div class="line">    &#125;</div><div class="line">    dividerPopupDiv = d3.select(model.listContainer).select(`.$&#123;style.jsDividerPopup&#125;`);</div><div class="line">    if (dividerPopupDiv.empty()) &#123;</div><div class="line">      dividerPopupDiv = createDividerPopup();</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function showScore(def) &#123;</div><div class="line">  // show the regions when: editing, or when they are non-default. CSS rule makes visible on hover.</div><div class="line">  return (def.editScore || (typeof def.regions !== 'undefined' &amp;&amp;</div><div class="line">                            ((def.regions.length &gt; 1) || (def.regions[0] !== model.defaultScore))));</div><div class="line">&#125;</div><div class="line"></div><div class="line">export function filterFieldNames(fieldNames) &#123;</div><div class="line">  if (getDisplayOnlyScored()) &#123;</div><div class="line">    // filter for fields that have scores</div><div class="line">    return fieldNames.filter((name) =&gt; (showScore(model.provider.getField(name))));</div><div class="line">  &#125;</div><div class="line">  return fieldNames;</div><div class="line">&#125;</div><div class="line"></div><div class="line">const getMouseCoords = (tdsl) =&gt; &#123;</div><div class="line">  // y-coordinate is not handled correctly for svg or svgGr or overlay inside scrolling container.</div><div class="line">  const coord = d3.mouse(tdsl.node());</div><div class="line">  return [coord[0] - model.histMargin.left, coord[1] - model.histMargin.top];</div><div class="line">&#125;;</div><div class="line"></div><div class="line">export function prepareItem(def, idx, svgGr, hobj, tdsl) &#123;</div><div class="line">  if (typeof model.scores === 'undefined') return;</div><div class="line">  if (typeof def.dividers === 'undefined') &#123;</div><div class="line">    def.dividers = [];</div><div class="line">    def.regions = [model.defaultScore];</div><div class="line">    def.editScore = false;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  const gScore = svgGr.select(`.$&#123;style.jsScore&#125;`);</div><div class="line">  let drag = null;</div><div class="line">  if (def.editScore) &#123;</div><div class="line">    // add temp dragged divider, if needed.</div><div class="line">    const dividerData = ((typeof def.dragDivider !== 'undefined') &amp;&amp; def.dragDivider.newDivider.value !== undefined) ?</div><div class="line">                          def.dividers.concat(def.dragDivider.newDivider) : def.dividers;</div><div class="line">    const dividers = gScore.selectAll('line')</div><div class="line">      .data(dividerData);</div><div class="line">    dividers.enter().append('line');</div><div class="line">    dividers</div><div class="line">      .attr('x1', d =&gt; def.xScale(d.value))</div><div class="line">      .attr('y1', 0)</div><div class="line">      .attr('x2', d =&gt; def.xScale(d.value))</div><div class="line">      .attr('y2', () =&gt; model.histHeight)</div><div class="line">      .attr('stroke-width', 1)</div><div class="line">      .attr('stroke', 'black');</div><div class="line">    dividers.exit().remove();</div><div class="line"></div><div class="line">    const uncertRegions = gScore.selectAll(`.$&#123;style.jsScoreUncertainty&#125;`)</div><div class="line">      .data(dividerData);</div><div class="line">    uncertRegions.enter().append('rect')</div><div class="line">      .classed(style.jsScoreUncertainty, true)</div><div class="line">      .attr('rx', 8)</div><div class="line">      .attr('ry', 8);</div><div class="line">    uncertRegions</div><div class="line">      .attr('x', d =&gt; def.xScale(d.value - 0.005 * d.uncertainty * (hobj.max - hobj.min)))</div><div class="line">      .attr('y', 0)</div><div class="line">      // to get a width, need to start from 'zero' of this scale, which is hobj.min</div><div class="line">      .attr('width', (d, i) =&gt; def.xScale(hobj.min + 0.01 * d.uncertainty * (hobj.max - hobj.min)))</div><div class="line">      .attr('height', () =&gt; model.histHeight)</div><div class="line">      .attr('fill', '#000')</div><div class="line">      .attr('opacity', (d) =&gt; (d.uncertainty &gt; 0 ? '0.2' : '0'));</div><div class="line">    uncertRegions.exit().remove();</div><div class="line"></div><div class="line">    let dragDivLabel = gScore.select(`.$&#123;style.jsScoreDivLabel&#125;`);</div><div class="line">    if (typeof def.dragDivider !== 'undefined') &#123;</div><div class="line">      if (dragDivLabel.empty()) &#123;</div><div class="line">        dragDivLabel = gScore.append('text')</div><div class="line">          .classed(style.jsScoreDivLabel, true)</div><div class="line">          .attr('text-anchor', 'middle')</div><div class="line">          .attr('stroke', 'none')</div><div class="line">          .attr('background-color', '#fff')</div><div class="line">          .attr('dy', '.71em');</div><div class="line">      &#125;</div><div class="line">      const formatter = d3.format('.3s');</div><div class="line">      const divVal = (def.dragDivider.newDivider.value !== undefined ?</div><div class="line">                      def.dragDivider.newDivider.value :</div><div class="line">                      def.dividers[def.dragDivider.index].value);</div><div class="line">      dragDivLabel</div><div class="line">        .text(formatter(divVal))</div><div class="line">        .attr('x', `$&#123;def.xScale(divVal)&#125;`)</div><div class="line">        .attr('y', `$&#123;model.histHeight + 2&#125;`);</div><div class="line">    &#125; else if (!dragDivLabel.empty()) &#123;</div><div class="line">      dragDivLabel.remove();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // divider interaction events.</div><div class="line">    // Drag flow: drag a divider inside its current neighbors.</div><div class="line">    // A divider outside its neighbors or a new divider is a temp divider,</div><div class="line">    // added to the end of the list when rendering. Doesn't affect regions that way.</div><div class="line">    drag = d3.behavior.drag()</div><div class="line">      .on('dragstart', () =&gt; &#123;</div><div class="line">        const overCoords = getMouseCoords(tdsl);</div><div class="line">        const [val, , hitIndex] = dividerPick(overCoords, def, model.dragMargin, hobj.min);</div><div class="line">        if (d3.event.sourceEvent.altKey || d3.event.sourceEvent.ctrlKey) &#123;</div><div class="line">          // create a temp divider to render.</div><div class="line">          def.dragDivider = createDragDivider(-1, val, def, hobj);</div><div class="line">          publicAPI.render();</div><div class="line">        &#125; else &#123;</div><div class="line">          if (hitIndex &gt;= 0) &#123;</div><div class="line">            // start dragging existing divider</div><div class="line">            // it becomes a temporary copy if we go outside our bounds</div><div class="line">            def.dragDivider = createDragDivider(hitIndex, undefined, def, hobj);</div><div class="line">            // console.log('drag start ', hitIndex, def.dragDivider.low, def.dragDivider.high);</div><div class="line">            publicAPI.render();</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;)</div><div class="line">      .on('drag', () =&gt; &#123;</div><div class="line">        const overCoords = getMouseCoords(tdsl);</div><div class="line">        if (typeof def.dragDivider === 'undefined' ||</div><div class="line">            scorePopupDiv.style('display') !== 'none' ||</div><div class="line">            dividerPopupDiv.style('display') !== 'none') return;</div><div class="line">        const val = def.xScale.invert(overCoords[0]);</div><div class="line">        moveDragDivider(val, def);</div><div class="line">        publicAPI.render(def.name);</div><div class="line">      &#125;)</div><div class="line">      .on('dragend', () =&gt; &#123;</div><div class="line">        if (typeof def.dragDivider === 'undefined' ||</div><div class="line">            scorePopupDiv.style('display') !== 'none' ||</div><div class="line">            dividerPopupDiv.style('display') !== 'none') return;</div><div class="line">        finishDivider(def, hobj);</div><div class="line">        publicAPI.render();</div><div class="line">      &#125;);</div><div class="line">  &#125; else &#123;</div><div class="line">    gScore.selectAll('line').remove();</div><div class="line">    gScore.selectAll(`.$&#123;style.jsScoreUncertainty&#125;`).remove();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // score regions</div><div class="line">  // there are implicit bounds at the min and max.</div><div class="line">  const regionBounds = [hobj.min].concat(def.dividers.map((div) =&gt; (div.value)), hobj.max);</div><div class="line">  const scoreRegions = gScore.selectAll(`.$&#123;style.jsScoreRect&#125;`)</div><div class="line">    .data(def.regions);</div><div class="line">  // duplicate background regions are opaque, for a solid bright color.</div><div class="line">  const scoreBgRegions = svgGr.select(`.$&#123;style.jsScoreBackground&#125;`).selectAll('rect')</div><div class="line">    .data(def.regions);</div><div class="line">  [&#123; sel: scoreRegions, opacity: 0.2, class: style.scoreRegionFg &#125;,</div><div class="line">    &#123; sel: scoreBgRegions, opacity: 1.0, class: style.scoreRegionBg &#125;].forEach((reg) =&gt; &#123;</div><div class="line">      reg.sel.enter().append('rect')</div><div class="line">        .classed(reg.class, true);</div><div class="line">      reg.sel</div><div class="line">        .attr('x', (d, i) =&gt; def.xScale(regionBounds[i]))</div><div class="line">        .attr('y', def.editScore ? 0 : model.histHeight)</div><div class="line">        // width might be zero if a divider is dragged all the way to min/max.</div><div class="line">        .attr('width', (d, i) =&gt; def.xScale(regionBounds[i + 1]) - def.xScale(regionBounds[i]))</div><div class="line">        .attr('height', def.editScore ? model.histHeight : model.histMargin.bottom)</div><div class="line">        .attr('fill', (d) =&gt; (model.scores[d].color))</div><div class="line">        .attr('opacity', showScore(def) ? reg.opacity : '0');</div><div class="line">      reg.sel.exit().remove();</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">  // invisible overlay to catch mouse events.</div><div class="line">  const svgOverlay = svgGr.select(`.$&#123;style.jsOverlay&#125;`);</div><div class="line">  svgOverlay</div><div class="line">    .attr('width', model.histWidth)</div><div class="line">    .attr('height', model.histHeight + model.histMargin.bottom) // allow clicks inside x-axis.</div><div class="line">    .on('click', () =&gt; &#123;</div><div class="line">      // preventDefault() in dragstart didn't help, so watch for altKey or ctrlKey.</div><div class="line">      if (d3.event.defaultPrevented || d3.event.altKey || d3.event.ctrlKey) return; // click suppressed (by drag handling)</div><div class="line">      const overCoords = getMouseCoords(tdsl);</div><div class="line">      if (overCoords[1] &gt; model.histHeight) &#123;</div><div class="line">        def.editScore = !def.editScore;</div><div class="line">        svgOverlay.style('cursor', def.editScore ? 's-resize' : 'pointer');</div><div class="line">        publicAPI.render();</div><div class="line">        return;</div><div class="line">      &#125;</div><div class="line">      if (def.editScore) &#123;</div><div class="line">        // if we didn't create or drag a divider, pick a region or divider</div><div class="line">        const hitRegionIndex = regionPick(overCoords, def, hobj);</div><div class="line">        // select a def, show popup.</div><div class="line">        def.hitRegionIndex = hitRegionIndex;</div><div class="line">        // create a temp divider in case we choose 'new |' from the popup.</div><div class="line">        const [val, , hitIndex] = dividerPick(overCoords, def, model.dragMargin, hobj.min);</div><div class="line">        const coord = d3.mouse(model.listContainer);</div><div class="line">        model.selectedDef = def;</div><div class="line">        if (hitIndex &gt;= 0) &#123;</div><div class="line">          // pick an existing divider, popup to edit value, uncertainty, or delete.</div><div class="line">          def.dragDivider = createDragDivider(hitIndex, undefined, def, hobj);</div><div class="line">          showDividerPopup(dividerPopupDiv, model.selectedDef, hobj, coord);</div><div class="line">        &#125; else &#123;</div><div class="line">          if (typeof def.dragDivider === 'undefined') &#123;</div><div class="line">            def.dragDivider = createDragDivider(-1, val, def, hobj);</div><div class="line">          &#125; else &#123;</div><div class="line">            console.log('DBG unexpected existing divider');</div><div class="line">            def.dragDivider.newDivider.value = val;</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          const selRow = def.regions[def.hitRegionIndex];</div><div class="line">          showScorePopup(scorePopupDiv, coord, selRow);</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">    .on('mousemove', () =&gt; &#123;</div><div class="line">      const overCoords = getMouseCoords(tdsl);</div><div class="line">      if (def.editScore) &#123;</div><div class="line">        const [, , hitIndex] = dividerPick(overCoords, def, model.dragMargin, hobj.min);</div><div class="line">        let cursor = 'pointer';</div><div class="line">        // if we're over the bottom, indicate a click will shrink regions</div><div class="line">        if (overCoords[1] &gt; model.histHeight) cursor = 's-resize';</div><div class="line">        // if we're over a divider, indicate drag-to-move</div><div class="line">        else if ((def.dragIndex &gt;= 0) || (hitIndex &gt;= 0)) cursor = 'ew-resize';</div><div class="line">        // if modifiers are held down, we'll create a divider</div><div class="line">        else if (d3.event.altKey || d3.event.ctrlKey) cursor = 'crosshair';</div><div class="line">        svgOverlay.style('cursor', cursor);</div><div class="line">      &#125; else &#123;</div><div class="line">        // over the bottom, indicate we can start editing regions</div><div class="line">        const pickIt = overCoords[1] &gt; model.histHeight;</div><div class="line">        svgOverlay.style('cursor', pickIt ? 'pointer' : 'default');</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  if (def.editScore) &#123;</div><div class="line">    svgOverlay.call(drag);</div><div class="line">  &#125; else &#123;</div><div class="line">    svgOverlay.on('.drag', null);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">export default &#123;</div><div class="line">  createGroups,</div><div class="line">  createHeader,</div><div class="line">  createPopups,</div><div class="line">  filterFieldNames,</div><div class="line">  init,</div><div class="line">  prepareItem,</div><div class="line">  // showScore,</div><div class="line">  updateHeader,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>index.js</span></figcaption><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> CompositeClosureHelper <span class="keyword">from</span> <span class="string">'../../../Common/Core/CompositeClosureHelper'</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> d3 <span class="keyword">from</span> <span class="string">'d3'</span>;</div><div class="line"><span class="comment">/* eslint-disable import/no-unresolved */</span></div><div class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">'PVWStyle/InfoVizNative/HistogramSelector.mcss'</span>;</div><div class="line"><span class="comment">/* eslint-enable import/no-unresolved */</span></div><div class="line"><span class="keyword">import</span> multiClicker <span class="keyword">from</span> <span class="string">'../../Core/D3MultiClick'</span>;</div><div class="line"><span class="comment">// import template from './template.html';</span></div><div class="line"><span class="keyword">import</span> Score <span class="keyword">from</span> <span class="string">'./Score'</span>;</div><div class="line"></div><div class="line"><span class="comment">// ----------------------------------------------------------------------------</span></div><div class="line"><span class="comment">// Histogram Selector</span></div><div class="line"><span class="comment">// ----------------------------------------------------------------------------</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// This component is designed to display histograms in a grid and support</span></div><div class="line"><span class="comment">// user selection of histograms. The idea being to allow the user to view</span></div><div class="line"><span class="comment">// histograms for a large number of parameters and then select some of</span></div><div class="line"><span class="comment">// those parameters to use in further visualizations.</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Due to the large number of DOM elements a histogram can have, we modify</span></div><div class="line"><span class="comment">// the standard D3 graph approach to reuse DOM elements as the histograms</span></div><div class="line"><span class="comment">// scroll offscreen.  This way we can support thousands of histograms</span></div><div class="line"><span class="comment">// while only creating enough DOM elements to fill the screen.</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// A Transform is used to reposition existing DOM elements as they</span></div><div class="line"><span class="comment">// are reused. Supposedly this is a fast operation. The idea comes from</span></div><div class="line"><span class="comment">// http://bl.ocks.org/gmaclennan/11130600 among other examples.</span></div><div class="line"><span class="comment">// Reuse happens at the row level.</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// The maxBoxSize variable controls the largest width that a box</span></div><div class="line"><span class="comment">// (histogram) will use. This code will fill its container with the</span></div><div class="line"><span class="comment">// largest size histogram it can that does not exceed this limit and</span></div><div class="line"><span class="comment">// provides an integral number of histograms across the container's width.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">histogramSelector</span>(<span class="params">publicAPI, model</span>) </span>&#123;</div><div class="line">  <span class="comment">// in contact-sheet mode, specify the largest width a histogram can grow</span></div><div class="line">  <span class="comment">// to before more histograms are created to fill the container's width</span></div><div class="line">  <span class="keyword">const</span> maxBoxSize = <span class="number">240</span>;</div><div class="line">  <span class="keyword">const</span> legendSize = <span class="number">15</span>;</div><div class="line">  <span class="keyword">let</span> displayOnlySelected = <span class="literal">false</span>;</div><div class="line"></div><div class="line">  <span class="keyword">let</span> lastNumFields = <span class="number">0</span>;</div><div class="line"></div><div class="line">  Score.init(publicAPI, model);</div><div class="line"></div><div class="line">  <span class="comment">// This function modifies the Transform property</span></div><div class="line">  <span class="comment">// of the rows of the grid. Instead of creating new</span></div><div class="line">  <span class="comment">// rows filled with DOM elements. Inside histogramSelector()</span></div><div class="line">  <span class="comment">// to make sure document.head/body exists.</span></div><div class="line">  <span class="keyword">const</span> transformCSSProp = (<span class="function"><span class="keyword">function</span> <span class="title">tcssp</span>(<span class="params">property</span>) </span>&#123;</div><div class="line">    <span class="keyword">const</span> prefixes = [<span class="string">'webkit'</span>, <span class="string">'ms'</span>, <span class="string">'Moz'</span>, <span class="string">'O'</span>];</div><div class="line">    <span class="keyword">let</span> i = <span class="number">-1</span>;</div><div class="line">    <span class="keyword">const</span> n = prefixes.length;</div><div class="line">    <span class="keyword">const</span> s = (<span class="built_in">document</span>.head ? <span class="built_in">document</span>.head.style : (<span class="built_in">document</span>.body ? <span class="built_in">document</span>.body.style : <span class="literal">null</span>));</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (s === <span class="literal">null</span> || property.toLowerCase() <span class="keyword">in</span> s) &#123;</div><div class="line">      <span class="keyword">return</span> property.toLowerCase();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">while</span> (++i &lt; n) &#123;</div><div class="line">      <span class="keyword">if</span> (prefixes[i] + property <span class="keyword">in</span> s) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">`-<span class="subst">$&#123;prefixes[i].toLowerCase()&#125;</span><span class="subst">$&#123;property.replace(/([A-Z])/g, '-$1').toLowerCase()&#125;</span>`</span>;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">  &#125;(<span class="string">'Transform'</span>));</div><div class="line"></div><div class="line">  <span class="comment">// Apply our desired attributes to the grid rows</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">styleRows</span>(<span class="params">selection, self</span>) </span>&#123;</div><div class="line">    selection</div><div class="line">      .classed(style.row, <span class="literal">true</span>)</div><div class="line">      .style(<span class="string">'height'</span>, <span class="string">`<span class="subst">$&#123;self.boxHeight&#125;</span>px`</span>)</div><div class="line">      .style(transformCSSProp, (d, i) =&gt;</div><div class="line">        <span class="string">`translate3d(0,<span class="subst">$&#123;d.key * self.boxHeight&#125;</span>px,0)`</span></div><div class="line">      );</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// apply our desired attributes to the boxes of a row</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">styleBoxes</span>(<span class="params">selection, self</span>) </span>&#123;</div><div class="line">    selection</div><div class="line">      .style(<span class="string">'width'</span>, <span class="string">`<span class="subst">$&#123;self.boxWidth&#125;</span>px`</span>)</div><div class="line">      .style(<span class="string">'height'</span>, <span class="string">`<span class="subst">$&#123;self.boxHeight&#125;</span>px`</span>)</div><div class="line">      <span class="comment">// .style('margin', `$&#123;self.boxMargin / 2&#125;px`)</span></div><div class="line">    ;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">svgWidth</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> model.histWidth + model.histMargin.left + model.histMargin.right;</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">svgHeight</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> model.histHeight + model.histMargin.top + model.histMargin.bottom;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fetchData</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    model.needData = <span class="literal">true</span>;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (model.provider) &#123;</div><div class="line">      <span class="keyword">let</span> dataToLoadCount = <span class="number">0</span>;</div><div class="line"></div><div class="line">      <span class="keyword">let</span> fieldNames = [];</div><div class="line">      <span class="comment">// Initialize fields</span></div><div class="line">      <span class="keyword">if</span> (model.provider.isA(<span class="string">'FieldProvider'</span>)) &#123;</div><div class="line">        fieldNames = model.provider.getFieldNames();</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// Fetch 1D Histogram</span></div><div class="line">      <span class="keyword">if</span> (model.provider.isA(<span class="string">'Histogram1DProvider'</span>)) &#123;</div><div class="line">        dataToLoadCount += fieldNames.length;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; fieldNames.length; i++) &#123;</div><div class="line">          <span class="comment">// Return true if the data is already loaded</span></div><div class="line">          dataToLoadCount -= model.provider.loadHistogram1D(fieldNames[i])</div><div class="line">            ? <span class="number">1</span> : <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// Fetch Selection</span></div><div class="line">      <span class="keyword">if</span> (model.provider.isA(<span class="string">'SelectionProvider'</span>)) &#123;</div><div class="line">        <span class="comment">// fetchSelectionData();</span></div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// Check if we can render or not</span></div><div class="line">      model.needData = !!dataToLoadCount;</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (!model.needData) &#123;</div><div class="line">        publicAPI.render();</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">updateSizeInformation</span>(<span class="params">singleMode</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> updateBoxPerRow = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">const</span> clientRect = model.listContainer.getBoundingClientRect();</div><div class="line"></div><div class="line">    <span class="comment">// hard coded because I did not figure out how to</span></div><div class="line">    <span class="comment">// properly query this value from our container.</span></div><div class="line">    <span class="keyword">const</span> borderSize = <span class="number">3</span>;</div><div class="line">    <span class="comment">// 8? for linux/firefox, 10 for win10/chrome</span></div><div class="line">    <span class="keyword">const</span> scrollbarWidth = <span class="number">10</span>;</div><div class="line">    <span class="keyword">const</span> boxOutline = <span class="number">2</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Get the client area size</span></div><div class="line">    <span class="keyword">const</span> dimensions = [clientRect.width - <span class="number">2</span> * borderSize - scrollbarWidth,</div><div class="line">                        clientRect.height - <span class="number">2</span> * borderSize];</div><div class="line"></div><div class="line">    <span class="comment">// compute key values based on our new size</span></div><div class="line">    <span class="keyword">const</span> boxesPerRow = (singleMode ? <span class="number">1</span> : <span class="built_in">Math</span>.ceil(dimensions[<span class="number">0</span>] / maxBoxSize));</div><div class="line">    model.boxWidth = <span class="built_in">Math</span>.floor(dimensions[<span class="number">0</span>] / boxesPerRow);</div><div class="line">    model.boxHeight = (singleMode ? <span class="built_in">Math</span>.floor(model.boxWidth * <span class="number">5</span> / <span class="number">8</span>) : model.boxWidth);</div><div class="line">    model.rowsPerPage = <span class="built_in">Math</span>.ceil(dimensions[<span class="number">1</span>] / model.boxHeight);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (boxesPerRow !== model.boxesPerRow) &#123;</div><div class="line">      updateBoxPerRow = <span class="literal">true</span>;</div><div class="line">      model.boxesPerRow = boxesPerRow;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    model.histWidth = model.boxWidth - boxOutline * <span class="number">2</span> -</div><div class="line">                      model.histMargin.left - model.histMargin.right;</div><div class="line">    <span class="comment">// other row size, probably a way to query for this</span></div><div class="line">    <span class="keyword">const</span> otherRowHeight = <span class="number">19</span>;</div><div class="line">    model.histHeight = model.boxHeight - boxOutline * <span class="number">2</span> - otherRowHeight -</div><div class="line">                       model.histMargin.top - model.histMargin.bottom;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> updateBoxPerRow;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// which row of model.nest does this field name reside in?</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getFieldRow</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (model.nest === <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">const</span> foundRow = model.nest.reduce((prev, item, i) =&gt; &#123;</div><div class="line">      <span class="keyword">const</span> val = item.value.filter((def) =&gt; (def.name === name));</div><div class="line">      <span class="keyword">if</span> (val.length &gt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> item.key;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> prev;</div><div class="line">    &#125;, <span class="number">0</span>);</div><div class="line">    <span class="keyword">return</span> foundRow;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">const</span> fieldHeaderClick = (d) =&gt; &#123;</div><div class="line">    displayOnlySelected = !displayOnlySelected;</div><div class="line">    publicAPI.render();</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">createHeader</span>(<span class="params">divSel</span>) </span>&#123;</div><div class="line">    <span class="keyword">const</span> header = divSel.append(<span class="string">'div'</span>)</div><div class="line">      .classed(style.header, <span class="literal">true</span>)</div><div class="line">      .style(<span class="string">'height'</span>, <span class="string">`<span class="subst">$&#123;model.headerSize&#125;</span>px`</span>);</div><div class="line">    header.append(<span class="string">'span'</span>)</div><div class="line">      .on(<span class="string">'click'</span>, fieldHeaderClick)</div><div class="line">      .append(<span class="string">'i'</span>)</div><div class="line">      .classed(style.jsFieldsIcon, <span class="literal">true</span>);</div><div class="line">    header.append(<span class="string">'span'</span>)</div><div class="line">      .classed(style.jsHeaderLabel, <span class="literal">true</span>)</div><div class="line">      .on(<span class="string">'click'</span>, fieldHeaderClick);</div><div class="line">    Score.createHeader(header);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">updateHeader</span>(<span class="params">dataLength</span>) </span>&#123;</div><div class="line">    d3.select(<span class="string">`.<span class="subst">$&#123;style.jsFieldsIcon&#125;</span>`</span>)</div><div class="line">      <span class="comment">// apply class - 'false' should come first to not remove common base class.</span></div><div class="line">      .classed(displayOnlySelected ? style.allFieldsIcon : style.selectedFieldsIcon, <span class="literal">false</span>)</div><div class="line">      .classed(!displayOnlySelected ? style.allFieldsIcon : style.selectedFieldsIcon, <span class="literal">true</span>);</div><div class="line">    d3.select(<span class="string">`.<span class="subst">$&#123;style.jsHeaderLabel&#125;</span>`</span>)</div><div class="line">      .text(!displayOnlySelected ? <span class="string">`All Variables (<span class="subst">$&#123;dataLength&#125;</span>)`</span> : <span class="string">`Selected Variables (<span class="subst">$&#123;dataLength&#125;</span>)`</span>);</div><div class="line">    Score.updateHeader();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  publicAPI.resize = () =&gt; &#123;</div><div class="line">    <span class="keyword">if</span> (model.container === <span class="literal">null</span>) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">    <span class="keyword">const</span> clientRect = model.container.getBoundingClientRect();</div><div class="line">    <span class="keyword">if</span> (clientRect.width !== <span class="number">0</span> &amp;&amp; clientRect.height !== <span class="number">0</span>) &#123;</div><div class="line">      model.containerHidden = <span class="literal">false</span>;</div><div class="line">      d3.select(model.listContainer)</div><div class="line">        .style(<span class="string">'height'</span>, <span class="string">`<span class="subst">$&#123;clientRect.height - model.headerSize&#125;</span>px`</span>);</div><div class="line">      publicAPI.render();</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      model.containerHidden = <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  publicAPI.render = (onlyFieldName = <span class="literal">null</span>) =&gt; &#123;</div><div class="line">    <span class="keyword">if</span> (model.needData) &#123;</div><div class="line">      fetchData();</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (model.container === <span class="literal">null</span>) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">    <span class="keyword">const</span> updateBoxPerRow = updateSizeInformation(model.singleMode);</div><div class="line"></div><div class="line">    <span class="keyword">let</span> fieldNames = [];</div><div class="line">    <span class="comment">// Initialize fields</span></div><div class="line">    <span class="keyword">if</span> (model.provider.isA(<span class="string">'FieldProvider'</span>)) &#123;</div><div class="line">      fieldNames = (!displayOnlySelected ? model.provider.getFieldNames() :</div><div class="line">         model.provider.getActiveFieldNames());</div><div class="line">    &#125;</div><div class="line">    fieldNames = Score.filterFieldNames(fieldNames);</div><div class="line"></div><div class="line">    updateHeader(fieldNames.length);</div><div class="line">    <span class="keyword">if</span> (updateBoxPerRow || fieldNames.length !== lastNumFields) &#123;</div><div class="line">      lastNumFields = fieldNames.length;</div><div class="line"></div><div class="line">      <span class="comment">// get the data and put it into the nest based on the</span></div><div class="line">      <span class="comment">// number of boxesPerRow</span></div><div class="line">      <span class="keyword">const</span> mungedData = fieldNames.map(name =&gt; &#123;</div><div class="line">        <span class="keyword">const</span> d = model.provider.getField(name);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> d.selectedGen === <span class="string">'undefined'</span>) &#123;</div><div class="line">          d.selectedGen = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> d;</div><div class="line">      &#125;);</div><div class="line"></div><div class="line">      model.nest = mungedData.reduce((prev, item, i) =&gt; &#123;</div><div class="line">        <span class="keyword">const</span> group = <span class="built_in">Math</span>.floor(i / model.boxesPerRow);</div><div class="line">        <span class="keyword">if</span> (prev[group]) &#123;</div><div class="line">          prev[group].value.push(item);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          prev.push(&#123;</div><div class="line">            key: group,</div><div class="line">            value: [item],</div><div class="line">          &#125;);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> prev;</div><div class="line">      &#125;, []);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// resize the div area to be tall enough to hold all our</span></div><div class="line">    <span class="comment">// boxes even though most are 'virtual' and lack DOM</span></div><div class="line">    <span class="keyword">const</span> newHeight = <span class="string">`<span class="subst">$&#123;Math.ceil(model.nest.length * model.boxHeight)&#125;</span>px`</span>;</div><div class="line">    model.parameterList.style(<span class="string">'height'</span>, newHeight);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!model.nest) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">    <span class="comment">// if we've changed view modes, single &lt;==&gt; contact sheet,</span></div><div class="line">    <span class="comment">// we need to re-scroll.</span></div><div class="line">    <span class="keyword">if</span> (model.scrollToName !== <span class="literal">null</span>) &#123;</div><div class="line">      <span class="keyword">const</span> topRow = getFieldRow(model.scrollToName);</div><div class="line">      model.listContainer.scrollTop = topRow * model.boxHeight;</div><div class="line">      model.scrollToName = <span class="literal">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">     <span class="comment">// scroll distance, in pixels.</span></div><div class="line">    <span class="keyword">const</span> scrollY = model.listContainer.scrollTop;</div><div class="line">    <span class="comment">// convert scroll from pixels to rows, get one row above (-1)</span></div><div class="line">    <span class="keyword">const</span> offset = <span class="built_in">Math</span>.max(<span class="number">0</span>, <span class="built_in">Math</span>.floor(scrollY / model.boxHeight) - <span class="number">1</span>);</div><div class="line"></div><div class="line">    <span class="comment">// extract the visible graphs from the data based on how many rows</span></div><div class="line">    <span class="comment">// we have scrolled down plus one above and one below (+2)</span></div><div class="line">    <span class="keyword">const</span> count = model.rowsPerPage + <span class="number">2</span>;</div><div class="line">    <span class="keyword">const</span> dataSlice = model.nest.slice(offset, offset + count);</div><div class="line"></div><div class="line">    <span class="comment">// attach our slice of data to the rows</span></div><div class="line">    <span class="keyword">const</span> rows = model.parameterList.selectAll(<span class="string">'div'</span>)</div><div class="line">      .data(dataSlice, (d) =&gt; d.key);</div><div class="line"></div><div class="line">    <span class="comment">// here is the code that reuses the exit nodes to fill entry</span></div><div class="line">    <span class="comment">// nodes. If there are not enough exit nodes then additional ones</span></div><div class="line">    <span class="comment">// will be created as needed. The boxes start off as hidden and</span></div><div class="line">    <span class="comment">// later have the class removed when their data is ready</span></div><div class="line">    <span class="keyword">const</span> exitNodes = rows.exit();</div><div class="line">    rows.enter().append(() =&gt; &#123;</div><div class="line">      <span class="keyword">let</span> reusableNode = <span class="number">0</span>;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; exitNodes[<span class="number">0</span>].length; i++) &#123;</div><div class="line">        reusableNode = exitNodes[<span class="number">0</span>][i];</div><div class="line">        <span class="keyword">if</span> (reusableNode) &#123;</div><div class="line">          exitNodes[<span class="number">0</span>][i] = <span class="literal">undefined</span>;</div><div class="line">          d3.select(reusableNode)</div><div class="line">              .selectAll(<span class="string">'table'</span>)</div><div class="line">              .classed(style.hiddenBox, <span class="literal">true</span>);</div><div class="line">          <span class="keyword">return</span> reusableNode;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line">    &#125;);</div><div class="line">    rows.call(styleRows, model);</div><div class="line"></div><div class="line">    <span class="comment">// if there are exit rows remaining that we</span></div><div class="line">    <span class="comment">// do not need we can delete them</span></div><div class="line">    rows.exit().remove();</div><div class="line"></div><div class="line">    <span class="comment">// now put the data into the boxes</span></div><div class="line">    <span class="keyword">const</span> boxes = rows.selectAll(<span class="string">'table'</span>).data((d) =&gt; d.value);</div><div class="line">    boxes.enter()</div><div class="line">      .append(<span class="string">'table'</span>)</div><div class="line">      .classed(style.hiddenBox, <span class="literal">true</span>);</div><div class="line"></div><div class="line">    <span class="comment">// free up any extra boxes</span></div><div class="line">    boxes.exit().remove();</div><div class="line"></div><div class="line">    <span class="comment">// scoring interface - create floating controls to set scores, values, when needed.</span></div><div class="line">    Score.createPopups();</div><div class="line"></div><div class="line">    <span class="comment">// for every item that has data, create all the sub-elements</span></div><div class="line">    <span class="comment">// and size them correctly based on our data</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">prepareItem</span>(<span class="params">def, idx</span>) </span>&#123;</div><div class="line">      <span class="comment">// updateData is called in response to UI events; it tells</span></div><div class="line">      <span class="comment">// the dataProvider to update the data to match the UI.</span></div><div class="line">      <span class="comment">//</span></div><div class="line">      <span class="comment">// updateData must be inside prepareItem() since it uses idx;</span></div><div class="line">      <span class="comment">// d3's listener method cannot guarantee the index passed to</span></div><div class="line">      <span class="comment">// updateData will be correct:</span></div><div class="line">      <span class="function"><span class="keyword">function</span> <span class="title">updateData</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">        <span class="comment">// data.selected = this.checked;</span></div><div class="line">        data.selectedGen++;</div><div class="line">        <span class="comment">// model.provider.updateField(data.name, &#123; active: data.selected &#125;);</span></div><div class="line">        model.provider.toggleFieldSelection(data.name);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// get existing sub elements</span></div><div class="line">      <span class="keyword">const</span> ttab = d3.select(<span class="keyword">this</span>);</div><div class="line">      <span class="keyword">let</span> trow1 = ttab.select(<span class="string">`tr.<span class="subst">$&#123;style.jsLegendRow&#125;</span>`</span>);</div><div class="line">      <span class="keyword">let</span> trow2 = ttab.select(<span class="string">`tr.<span class="subst">$&#123;style.jsTr2&#125;</span>`</span>);</div><div class="line">      <span class="keyword">let</span> tdsl = trow2.select(<span class="string">`td.<span class="subst">$&#123;style.jsSparkline&#125;</span>`</span>);</div><div class="line">      <span class="keyword">let</span> legendCell = trow1.select(<span class="string">`.<span class="subst">$&#123;style.jsLegend&#125;</span>`</span>);</div><div class="line">      <span class="keyword">let</span> fieldCell = trow1.select(<span class="string">`.<span class="subst">$&#123;style.jsFieldName&#125;</span>`</span>);</div><div class="line">      <span class="keyword">let</span> svgGr = tdsl.select(<span class="string">'svg'</span>).select(<span class="string">`.<span class="subst">$&#123;style.jsGHist&#125;</span>`</span>);</div><div class="line">      <span class="comment">// let svgOverlay = svgGr.select(`.$&#123;style.jsOverlay&#125;`);</span></div><div class="line"></div><div class="line">      <span class="comment">// if they are not created yet then create them</span></div><div class="line">      <span class="keyword">if</span> (trow1.empty()) &#123;</div><div class="line">        trow1 = ttab.append(<span class="string">'tr'</span>).classed(style.legendRow, <span class="literal">true</span>)</div><div class="line">          .on(<span class="string">'click'</span>, multiClicker([</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">singleClick</span>(<span class="params">d, i</span>) </span>&#123; <span class="comment">// single click handler</span></div><div class="line">              <span class="comment">// const overCoords = d3.mouse(model.listContainer);</span></div><div class="line">              updateData(d);</div><div class="line">            &#125;,</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">doubleClick</span>(<span class="params">d, i</span>) </span>&#123; <span class="comment">// double click handler</span></div><div class="line">              model.singleMode = !model.singleMode;</div><div class="line">              model.scrollToName = d.name;</div><div class="line">              publicAPI.render();</div><div class="line"></div><div class="line">              d3.event.stopPropagation();</div><div class="line">            &#125;,</div><div class="line">          ])</div><div class="line">          );</div><div class="line">        trow2 = ttab.append(<span class="string">'tr'</span>).classed(style.jsTr2, <span class="literal">true</span>);</div><div class="line">        tdsl = trow2.append(<span class="string">'td'</span>).classed(style.sparkline, <span class="literal">true</span>).attr(<span class="string">'colspan'</span>, <span class="string">'2'</span>);</div><div class="line">        legendCell = trow1</div><div class="line">          .append(<span class="string">'td'</span>)</div><div class="line">          .classed(style.legend, <span class="literal">true</span>);</div><div class="line"></div><div class="line">        fieldCell = trow1</div><div class="line">          .append(<span class="string">'td'</span>)</div><div class="line">          .classed(style.fieldName, <span class="literal">true</span>);</div><div class="line"></div><div class="line">        <span class="comment">// Create SVG, and main group created inside the margins for use by axes, title, etc.</span></div><div class="line">        svgGr = tdsl.append(<span class="string">'svg'</span>).classed(style.sparklineSvg, <span class="literal">true</span>)</div><div class="line">          .append(<span class="string">'g'</span>)</div><div class="line">            .classed(style.jsGHist, <span class="literal">true</span>)</div><div class="line">            .attr(<span class="string">'transform'</span>, <span class="string">`translate( <span class="subst">$&#123;model.histMargin.left&#125;</span>, <span class="subst">$&#123;model.histMargin.top&#125;</span> )`</span>);</div><div class="line">        <span class="comment">// nested groups inside main group</span></div><div class="line">        svgGr.append(<span class="string">'g'</span>)</div><div class="line">          .classed(style.axis, <span class="literal">true</span>);</div><div class="line">        svgGr.append(<span class="string">'g'</span>)</div><div class="line">          .classed(style.jsGRect, <span class="literal">true</span>);</div><div class="line">        <span class="comment">// scoring interface</span></div><div class="line">        Score.createGroups(svgGr);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">const</span> dataActive = def.active;</div><div class="line">      <span class="comment">// Apply legend</span></div><div class="line">      <span class="keyword">if</span> (model.provider.isA(<span class="string">'LegendProvider'</span>)) &#123;</div><div class="line">        <span class="keyword">const</span> &#123; color, shape &#125; = model.provider.getLegend(def.name);</div><div class="line">        legendCell</div><div class="line">          .html(<span class="string">`&lt;svg class='<span class="subst">$&#123;style.legendSvg&#125;</span>' width='<span class="subst">$&#123;legendSize&#125;</span>' height='<span class="subst">$&#123;legendSize&#125;</span>'</span></div><div class="line">                  fill='<span class="subst">$&#123;color&#125;</span>' stroke='black'&gt;&lt;use xlink:href='<span class="subst">$&#123;shape&#125;</span>'/&gt;&lt;/svg&gt;`);</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        legendCell</div><div class="line">          .html(<span class="string">'&lt;i&gt;&lt;/i&gt;'</span>)</div><div class="line">          .select(<span class="string">'i'</span>);</div><div class="line">      &#125;</div><div class="line">      trow1</div><div class="line">        .classed(!dataActive ? style.selectedLegendRow : style.unselectedLegendRow, <span class="literal">false</span>)</div><div class="line">        .classed(dataActive ? style.selectedLegendRow : style.unselectedLegendRow, <span class="literal">true</span>);</div><div class="line">      <span class="comment">// selection outline</span></div><div class="line">      ttab</div><div class="line">        .classed(style.hiddenBox, <span class="literal">false</span>)</div><div class="line">        .classed(!dataActive ? style.selectedBox : style.unselectedBox, <span class="literal">false</span>)</div><div class="line">        .classed(dataActive ? style.selectedBox : style.unselectedBox, <span class="literal">true</span>);</div><div class="line"></div><div class="line">      <span class="comment">// Apply field name</span></div><div class="line">      fieldCell.text(def.name);</div><div class="line"></div><div class="line">      <span class="comment">// adjust some settings based on current size</span></div><div class="line">      tdsl.select(<span class="string">'svg'</span>)</div><div class="line">        .attr(<span class="string">'width'</span>, svgWidth())</div><div class="line">        .attr(<span class="string">'height'</span>, svgHeight());</div><div class="line"></div><div class="line">      <span class="comment">// get the histogram data and rebuild the histogram based on the results</span></div><div class="line">      <span class="keyword">const</span> hobj = model.provider.getHistogram1D(def.name);</div><div class="line">      <span class="keyword">if</span> (hobj !== <span class="literal">null</span>) &#123;</div><div class="line">        <span class="keyword">const</span> cmax = <span class="number">1.0</span> * d3.max(hobj.counts);</div><div class="line">        <span class="keyword">const</span> hsize = hobj.counts.length;</div><div class="line">        <span class="keyword">const</span> hdata = svgGr.select(<span class="string">`.<span class="subst">$&#123;style.jsGRect&#125;</span>`</span>)</div><div class="line">          .selectAll(<span class="string">`.<span class="subst">$&#123;style.jsHistRect&#125;</span>`</span>).data(hobj.counts);</div><div class="line"></div><div class="line">        hdata.enter().append(<span class="string">'rect'</span>);</div><div class="line">        <span class="comment">// changes apply to both enter and update data join:</span></div><div class="line">        hdata</div><div class="line">          .classed(style.histRect, <span class="literal">true</span>)</div><div class="line">          .attr(<span class="string">'pname'</span>, def.name)</div><div class="line">          .attr(<span class="string">'y'</span>, d =&gt; model.histHeight * (<span class="number">1.0</span> - d / cmax))</div><div class="line">          .attr(<span class="string">'x'</span>, (d, i) =&gt; (model.histWidth / hsize) * i)</div><div class="line">          .attr(<span class="string">'height'</span>, d =&gt; model.histHeight * d / cmax)</div><div class="line">          .attr(<span class="string">'width'</span>, model.histWidth / hsize);</div><div class="line"></div><div class="line">        hdata.exit().remove();</div><div class="line">        <span class="comment">// svgGr.</span></div><div class="line">        <span class="comment">// on('mousemove', (d, i) =&gt; &#123;</span></div><div class="line">        <span class="comment">//   // console.log('MouseMove!');</span></div><div class="line">        <span class="comment">//   if (model.annotationService) &#123;</span></div><div class="line">        <span class="comment">//     const mCoords = d3.mouse(svgGr[0][0]);</span></div><div class="line">        <span class="comment">//     const binNum = Math.floor((mCoords[0] / model.histWidth) * hsize);</span></div><div class="line">        <span class="comment">//     const state = &#123;&#125;;</span></div><div class="line">        <span class="comment">//     state[def.name] = [binNum];</span></div><div class="line">        <span class="comment">//     model.annotationService.setCurrentHover(&#123;</span></div><div class="line">        <span class="comment">//       source: model.componentId,</span></div><div class="line">        <span class="comment">//       state,</span></div><div class="line">        <span class="comment">//     &#125;);</span></div><div class="line">        <span class="comment">//   &#125;</span></div><div class="line">        <span class="comment">// &#125;).</span></div><div class="line">        <span class="comment">// on('mouseout', (d, i) =&gt; &#123;</span></div><div class="line">        <span class="comment">//   if (model.annotationService) &#123;</span></div><div class="line">        <span class="comment">//     const state = &#123;&#125;;</span></div><div class="line">        <span class="comment">//     state[def.name] = [-1];</span></div><div class="line">        <span class="comment">//     model.annotationService.setCurrentHover(&#123;</span></div><div class="line">        <span class="comment">//       source: self.componentId,</span></div><div class="line">        <span class="comment">//       state,</span></div><div class="line">        <span class="comment">//     &#125;);</span></div><div class="line">        <span class="comment">//   &#125;</span></div><div class="line">        <span class="comment">// &#125;);</span></div><div class="line"></div><div class="line">        <span class="comment">// Show an x-axis with just min/max displayed.</span></div><div class="line">        <span class="comment">// Attach scale, axis objects to this box's</span></div><div class="line">        <span class="comment">// data (the 'def' object) to allow persistence when scrolled.</span></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> def.xScale === <span class="string">'undefined'</span>) &#123;</div><div class="line">          def.xScale = d3.scale.linear();</div><div class="line">        &#125;</div><div class="line">        def.xScale</div><div class="line">          .rangeRound([<span class="number">0</span>, model.histWidth])</div><div class="line">          .domain([hobj.min, hobj.max]);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> def.xAxis === <span class="string">'undefined'</span>) &#123;</div><div class="line">          <span class="keyword">const</span> formatter = d3.format(<span class="string">'.3s'</span>);</div><div class="line">          def.xAxis = d3.svg.axis()</div><div class="line">          .tickFormat(formatter)</div><div class="line">          .orient(<span class="string">'bottom'</span>);</div><div class="line">        &#125;</div><div class="line">        def.xAxis</div><div class="line">          .scale(def.xScale);</div><div class="line">        <span class="keyword">let</span> numTicks = model.singleMode ? <span class="number">5</span> : <span class="number">2</span>;</div><div class="line">        <span class="keyword">if</span> (model.singleMode) &#123;</div><div class="line">          <span class="comment">// using .ticks() results in skipping min/max values,</span></div><div class="line">          <span class="comment">// if they aren't 'nice'. Make exactly 5 ticks.</span></div><div class="line">          <span class="keyword">const</span> myTicks = d3.range(numTicks).map((d) =&gt; (</div><div class="line">            hobj.min + (d / (numTicks - <span class="number">1</span>)) * (hobj.max - hobj.min))</div><div class="line">          );</div><div class="line">          def.xAxis</div><div class="line">            .tickValues(myTicks);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          def.xAxis</div><div class="line">            .tickValues(def.xScale.domain());</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// nested group for the x-axis min/max display.</span></div><div class="line">        <span class="keyword">const</span> gAxis = svgGr.select(<span class="string">`.<span class="subst">$&#123;style.jsAxis&#125;</span>`</span>);</div><div class="line">        gAxis</div><div class="line">          .attr(<span class="string">'transform'</span>, <span class="string">`translate(0, <span class="subst">$&#123;model.histHeight&#125;</span>)`</span>)</div><div class="line">          .call(def.xAxis);</div><div class="line">        <span class="keyword">const</span> tickLabels = gAxis.selectAll(<span class="string">'text'</span>)</div><div class="line">            .classed(style.axisText, <span class="literal">true</span>);</div><div class="line">        numTicks = tickLabels.size();</div><div class="line">        tickLabels</div><div class="line">            .style(<span class="string">'text-anchor'</span>, (d, i) =&gt; (</div><div class="line">              i === <span class="number">0</span> ? <span class="string">'start'</span> : (i === numTicks - <span class="number">1</span> ? <span class="string">'end'</span> : <span class="string">'middle'</span>)</div><div class="line">            ));</div><div class="line">        gAxis.selectAll(<span class="string">'line'</span>).classed(style.axisLine, <span class="literal">true</span>);</div><div class="line">        gAxis.selectAll(<span class="string">'path'</span>).classed(style.axisPath, <span class="literal">true</span>);</div><div class="line"></div><div class="line">        Score.prepareItem(def, idx, svgGr, hobj, tdsl);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// make sure all the elements are created</span></div><div class="line">    <span class="comment">// and updated</span></div><div class="line">    <span class="keyword">if</span> (onlyFieldName === <span class="literal">null</span>) &#123;</div><div class="line">      boxes.each(prepareItem);</div><div class="line">      boxes</div><div class="line">        .call(styleBoxes, model);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      boxes.filter((def) =&gt; (def.name === onlyFieldName)).each(prepareItem);</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  publicAPI.setContainer = (element) =&gt; &#123;</div><div class="line">    <span class="keyword">if</span> (model.container) &#123;</div><div class="line">      <span class="keyword">while</span> (model.container.firstChild) &#123;</div><div class="line">        model.container.removeChild(model.container.firstChild);</div><div class="line">      &#125;</div><div class="line">      model.container = <span class="literal">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    model.container = element;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (model.container !== <span class="literal">null</span>) &#123;</div><div class="line">      <span class="keyword">const</span> cSel = d3.select(model.container)</div><div class="line">        .style(<span class="string">'overflow-y'</span>, <span class="string">'hidden'</span>);</div><div class="line">      createHeader(cSel);</div><div class="line">      <span class="comment">// wrapper height is set insize resize()</span></div><div class="line">      <span class="keyword">const</span> wrapper = cSel.append(<span class="string">'div'</span>)</div><div class="line">        .style(<span class="string">'overflow-y'</span>, <span class="string">'auto'</span>)</div><div class="line">        .style(<span class="string">'overflow-x'</span>, <span class="string">'hidden'</span>)</div><div class="line">        .on(<span class="string">'scroll'</span>, () =&gt; &#123; publicAPI.render(); &#125;);</div><div class="line"></div><div class="line">      model.listContainer = wrapper.node();</div><div class="line">      model.parameterList = wrapper</div><div class="line">        .append(<span class="string">'div'</span>)</div><div class="line">        .classed(style.histogramSelector, <span class="literal">true</span>);</div><div class="line"></div><div class="line">      publicAPI.resize();</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  model.subscriptions.push(&#123; unsubscribe: publicAPI.setContainer &#125;);</div><div class="line">  <span class="comment">// event from the FieldProvider</span></div><div class="line">  <span class="comment">// TODO overkill if one field's 'active' flag changes.</span></div><div class="line">  model.subscriptions.push(model.provider.onFieldChange(fetchData));</div><div class="line">  <span class="comment">// event from Histogram Provider</span></div><div class="line">  model.subscriptions.push(model.provider.onHistogram1DReady(publicAPI.render));</div><div class="line"></div><div class="line">  <span class="comment">// Make sure default values get applied</span></div><div class="line">  publicAPI.setContainer(model.container);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ----------------------------------------------------------------------------</span></div><div class="line"><span class="comment">// Object factory</span></div><div class="line"><span class="comment">// ----------------------------------------------------------------------------</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> DEFAULT_VALUES = &#123;</div><div class="line">  container: <span class="literal">null</span>,</div><div class="line">  provider: <span class="literal">null</span>,</div><div class="line">  listContainer: <span class="literal">null</span>,</div><div class="line">  needData: <span class="literal">true</span>,</div><div class="line">  containerHidden: <span class="literal">false</span>,</div><div class="line"></div><div class="line">  parameterList: <span class="literal">null</span>,</div><div class="line">  nest: <span class="literal">null</span>, <span class="comment">// nested aray of data nest[rows][boxes]</span></div><div class="line">  boxesPerRow: <span class="number">0</span>,</div><div class="line">  rowsPerPage: <span class="number">0</span>,</div><div class="line">  boxWidth: <span class="number">120</span>,</div><div class="line">  boxHeight: <span class="number">120</span>,</div><div class="line">  <span class="comment">// show 1 per row?</span></div><div class="line">  singleMode: <span class="literal">false</span>,</div><div class="line">  scrollToName: <span class="literal">null</span>,</div><div class="line">  <span class="comment">// margins inside the SVG element.</span></div><div class="line">  histMargin: &#123; top: <span class="number">3</span>, right: <span class="number">3</span>, bottom: <span class="number">18</span>, left: <span class="number">3</span> &#125;,</div><div class="line">  histWidth: <span class="number">90</span>,</div><div class="line">  histHeight: <span class="number">70</span>,</div><div class="line">  lastOffset: <span class="number">-1</span>,</div><div class="line">  headerSize: <span class="number">20</span>,</div><div class="line">  <span class="comment">// scoring interface activated by passing in 'scores' array externally.</span></div><div class="line">  <span class="comment">// scores: [&#123; name: 'Yes', color: '#00C900' &#125;, ... ],</span></div><div class="line">  defaultScore: <span class="number">0</span>,</div><div class="line">  dragMargin: <span class="number">8</span>,</div><div class="line">  selectedDef: <span class="literal">null</span>,</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// ----------------------------------------------------------------------------</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">publicAPI, model, initialValues = &#123;&#125;</span>) </span>&#123;</div><div class="line">  <span class="built_in">Object</span>.assign(model, DEFAULT_VALUES, initialValues);</div><div class="line"></div><div class="line">  CompositeClosureHelper.destroy(publicAPI, model);</div><div class="line">  CompositeClosureHelper.isA(publicAPI, model, <span class="string">'VizComponent'</span>);</div><div class="line">  CompositeClosureHelper.get(publicAPI, model, [<span class="string">'provider'</span>, <span class="string">'container'</span>]);</div><div class="line"></div><div class="line">  histogramSelector(publicAPI, model);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ----------------------------------------------------------------------------</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> newInstance = CompositeClosureHelper.newInstance(extend);</div><div class="line"></div><div class="line"><span class="comment">// ----------------------------------------------------------------------------</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; newInstance, extend &#125;;</div></pre></td></tr></table></figure>

              </div>
              <footer class="article-footer">
                <time class="article-footer-updated" datetime="2016-07-19T21:41:51.674Z" itemprop="dateModified">Last updated: 2016-07-19</time>
                <a href="FieldSelector.html" class="article-footer-prev" title="FieldSelector"><i class="fa fa-chevron-left"></i><span>Prev</span></a><a href="MutualInformationDiagram.html" class="article-footer-next" title="MutualInformationDiagram"><span>Next</span><i class="fa fa-chevron-right"></i></a>
              </footer>
              
            </div>
          </div>
          <aside id="article-toc" role="navigation">
            <div id="article-toc-inner">
              <strong class="sidebar-title">Contents</strong>
              <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Source"><span class="toc-text">Source</span></a></li></ol>
              <a href="#" id="article-toc-top">Back to Top</a>
            </div>
          </aside>
        </div>
      </article>
      <aside id="sidebar" role="navigation">
  <div class="inner"><strong class="sidebar-title">Common/Core</strong><a href="CompositeClosureHelper.html" class="sidebar-link">CompositeClosureHelper</a><a href="LookupTable.html" class="sidebar-link">LookupTable</a><a href="LookupTableManager.html" class="sidebar-link">LookupTableManager</a><strong class="sidebar-title">Common/Misc</strong><a href="CanvasOffscreenBuffer.html" class="sidebar-link">CanvasOffscreenBuffer</a><a href="Convert.html" class="sidebar-link">Convert</a><a href="ConvertProxyProperty.html" class="sidebar-link">ConvertProxyProperty</a><a href="Debounce.html" class="sidebar-link">Debounce</a><a href="ImageExporter.html" class="sidebar-link">ImageExporter</a><a href="Loop.html" class="sidebar-link">Loop</a><a href="Observable.html" class="sidebar-link">Observable</a><a href="PingPong.html" class="sidebar-link">PingPong</a><a href="SizeHelper.html" class="sidebar-link">SizeHelper</a><a href="TimeProbeManager.html" class="sidebar-link">TimeProbeManager</a><a href="Validate.html" class="sidebar-link">Validate</a><a href="WebGl.html" class="sidebar-link">WebGl</a><strong class="sidebar-title">Common/State</strong><a href="EqualizerState.html" class="sidebar-link">EqualizerState</a><a href="PipelineState.html" class="sidebar-link">PipelineState</a><a href="ToggleState.html" class="sidebar-link">ToggleState</a><strong class="sidebar-title">IO/Core</strong><a href="CSVReader.html" class="sidebar-link">CSVReader</a><a href="DataManager.html" class="sidebar-link">DataManager</a><a href="GeometryDataModel.html" class="sidebar-link">GeometryDataModel</a><a href="ProcessLauncher.html" class="sidebar-link">ProcessLauncher</a><a href="QueryDataModel.html" class="sidebar-link">QueryDataModel</a><strong class="sidebar-title">IO/Girder</strong><a href="CoreEndpoints.html" class="sidebar-link">CoreEndpoints</a><a href="GirderClientBuilder.html" class="sidebar-link">GirderClientBuilder</a><strong class="sidebar-title">IO/WebSocket</strong><a href="AutobahnConnection.html" class="sidebar-link">AutobahnConnection</a><a href="BinaryImageStream.html" class="sidebar-link">BinaryImageStream</a><a href="ParaViewWebClient.html" class="sidebar-link">ParaViewWebClient</a><a href="SmartConnect.html" class="sidebar-link">SmartConnect</a><strong class="sidebar-title">InfoViz/Core</strong><a href="D3MultiClick.html" class="sidebar-link">D3MultiClick</a><a href="FieldProvider.html" class="sidebar-link">FieldProvider</a><a href="Histogram1DProvider.html" class="sidebar-link">Histogram1DProvider</a><a href="Histogram2DProvider.html" class="sidebar-link">Histogram2DProvider</a><a href="HistogramBinHoverProvider.html" class="sidebar-link">HistogramBinHoverProvider</a><a href="LegendProvider.html" class="sidebar-link">LegendProvider</a><a href="MutualInformationProvider.html" class="sidebar-link">MutualInformationProvider</a><a href="SelectionProvider.html" class="sidebar-link">SelectionProvider</a><strong class="sidebar-title">InfoViz/Native</strong><a href="FieldSelector.html" class="sidebar-link">FieldSelector</a><a href="HistogramSelector.html" class="sidebar-link current">HistogramSelector</a><a href="MutualInformationDiagram.html" class="sidebar-link">MutualInformationDiagram</a><a href="ParallelCoordinates.html" class="sidebar-link">ParallelCoordinates</a><strong class="sidebar-title">Interaction/Core</strong><a href="MouseHandler.html" class="sidebar-link">MouseHandler</a><a href="VtkWebMouseListener.html" class="sidebar-link">VtkWebMouseListener</a><strong class="sidebar-title">NativeUI/Canvas</strong><a href="GaussianPieceWiseEditor.html" class="sidebar-link">GaussianPieceWiseEditor</a><a href="LinearPieceWiseEditor.html" class="sidebar-link">LinearPieceWiseEditor</a><a href="RemoteRenderer.html" class="sidebar-link">RemoteRenderer</a><strong class="sidebar-title">NativeUI/Renderers</strong><a href="NativeImageRenderer.html" class="sidebar-link">NativeImageRenderer</a><strong class="sidebar-title">React/CollapsibleControls</strong><a href="CollapsibleControlFactory.html" class="sidebar-link">CollapsibleControlFactory</a><a href="FloatImageControl.html" class="sidebar-link">FloatImageControl</a><a href="LightControl.html" class="sidebar-link">LightControl</a><a href="LookupTableManagerControl.html" class="sidebar-link">LookupTableManagerControl</a><a href="MultiViewControl.html" class="sidebar-link">MultiViewControl</a><a href="PixelOperatorControl.html" class="sidebar-link">PixelOperatorControl</a><a href="PlotlyChartControl.html" class="sidebar-link">PlotlyChartControl</a><a href="ProbeControl.html" class="sidebar-link">ProbeControl</a><a href="QueryDataModelControl.html" class="sidebar-link">QueryDataModelControl</a><a href="TimeFloatImageControl.html" class="sidebar-link">TimeFloatImageControl</a><a href="VolumeControl.html" class="sidebar-link">VolumeControl</a><strong class="sidebar-title">React/Properties</strong><a href="CellProperty.html" class="sidebar-link">CellProperty</a><a href="CheckboxProperty.html" class="sidebar-link">CheckboxProperty</a><a href="EnumProperty.html" class="sidebar-link">EnumProperty</a><a href="MapProperty.html" class="sidebar-link">MapProperty</a><a href="PropertyFactory.html" class="sidebar-link">PropertyFactory</a><a href="PropertyPanel.html" class="sidebar-link">PropertyPanel</a><a href="SliderProperty.html" class="sidebar-link">SliderProperty</a><strong class="sidebar-title">React/Renderers</strong><a href="GeometryRenderer.html" class="sidebar-link">GeometryRenderer</a><a href="ImageRenderer.html" class="sidebar-link">ImageRenderer</a><a href="MultiLayoutRenderer.html" class="sidebar-link">MultiLayoutRenderer</a><a href="PlotlyRenderer.html" class="sidebar-link">PlotlyRenderer</a><a href="VtkRenderer.html" class="sidebar-link">VtkRenderer</a><strong class="sidebar-title">React/Viewers</strong><a href="AbstractViewerMenu.html" class="sidebar-link">AbstractViewerMenu</a><a href="ChartViewer.html" class="sidebar-link">ChartViewer</a><a href="GeometryViewer.html" class="sidebar-link">GeometryViewer</a><a href="ImageBuilderViewer.html" class="sidebar-link">ImageBuilderViewer</a><a href="LineChartViewer.html" class="sidebar-link">LineChartViewer</a><a href="MultiLayoutViewer.html" class="sidebar-link">MultiLayoutViewer</a><a href="Probe3DViewer.html" class="sidebar-link">Probe3DViewer</a><strong class="sidebar-title">React/Widgets</strong><a href="ActionListWidget.html" class="sidebar-link">ActionListWidget</a><a href="ButtonSelectorWidget.html" class="sidebar-link">ButtonSelectorWidget</a><a href="CollapsibleWidget.html" class="sidebar-link">CollapsibleWidget</a><a href="ColorByWidget.html" class="sidebar-link">ColorByWidget</a><a href="ColorMapEditorWidget.html" class="sidebar-link">ColorMapEditorWidget</a><a href="ColorPickerWidget.html" class="sidebar-link">ColorPickerWidget</a><a href="CompositePipelineWidget.html" class="sidebar-link">CompositePipelineWidget</a><a href="ContentEditableWidget.html" class="sidebar-link">ContentEditableWidget</a><a href="Coordinate2DWidget.html" class="sidebar-link">Coordinate2DWidget</a><a href="DoubleSliderWidget.html" class="sidebar-link">DoubleSliderWidget</a><a href="DropDownWidget.html" class="sidebar-link">DropDownWidget</a><a href="EqualizerWidget.html" class="sidebar-link">EqualizerWidget</a><a href="FileBrowserWidget.html" class="sidebar-link">FileBrowserWidget</a><a href="GitTreeWidget.html" class="sidebar-link">GitTreeWidget</a><a href="InlineToggleButtonWidget.html" class="sidebar-link">InlineToggleButtonWidget</a><a href="LayoutsWidget.html" class="sidebar-link">LayoutsWidget</a><a href="LookupTableWidget.html" class="sidebar-link">LookupTableWidget</a><a href="NumberInputWidget.html" class="sidebar-link">NumberInputWidget</a><a href="NumberSliderWidget.html" class="sidebar-link">NumberSliderWidget</a><a href="PieceWiseFunctionEditorWidget.html" class="sidebar-link">PieceWiseFunctionEditorWidget</a><a href="PresetListWidget.html" class="sidebar-link">PresetListWidget</a><a href="ProxyEditorWidget.html" class="sidebar-link">ProxyEditorWidget</a><a href="ProxyPropertyGroupWidget.html" class="sidebar-link">ProxyPropertyGroupWidget</a><a href="QueryDataModelWidget.html" class="sidebar-link">QueryDataModelWidget</a><a href="ResplendentWidget.html" class="sidebar-link">ResplendentWidget</a><a href="ScalarRangeWidget.html" class="sidebar-link">ScalarRangeWidget</a><a href="SvgIconWidget.html" class="sidebar-link">SvgIconWidget</a><a href="TextInputWidget.html" class="sidebar-link">TextInputWidget</a><a href="ToggleIconButtonWidget.html" class="sidebar-link">ToggleIconButtonWidget</a><a href="TogglePanelWidget.html" class="sidebar-link">TogglePanelWidget</a><strong class="sidebar-title">Rendering/Chart</strong><a href="PlotlyChartBuilder.html" class="sidebar-link">PlotlyChartBuilder</a><strong class="sidebar-title">Rendering/Geometry</strong><a href="ThreeGeometryBuilder.html" class="sidebar-link">ThreeGeometryBuilder</a><strong class="sidebar-title">Rendering/Image</strong><a href="AbstractImageBuilder.html" class="sidebar-link">AbstractImageBuilder</a><a href="BinaryDataProberImageBuilder.html" class="sidebar-link">BinaryDataProberImageBuilder</a><a href="CompositeImageBuilder.html" class="sidebar-link">CompositeImageBuilder</a><a href="DataProberImageBuilder.html" class="sidebar-link">DataProberImageBuilder</a><a href="DepthCompositeImageBuilder.html" class="sidebar-link">DepthCompositeImageBuilder</a><a href="DepthImageBuilder.html" class="sidebar-link">DepthImageBuilder</a><a href="FloatDataImageBuilder.html" class="sidebar-link">FloatDataImageBuilder</a><a href="FloatTimeDataImageBuilder.html" class="sidebar-link">FloatTimeDataImageBuilder</a><a href="MagicLensImageBuilder.html" class="sidebar-link">MagicLensImageBuilder</a><a href="MultiColorBySortedCompositeImageBuilder.html" class="sidebar-link">MultiColorBySortedCompositeImageBuilder</a><a href="PixelOperatorImageBuilder.html" class="sidebar-link">PixelOperatorImageBuilder</a><a href="QueryDataModelImageBuilder.html" class="sidebar-link">QueryDataModelImageBuilder</a><a href="SortedCompositeImageBuilder.html" class="sidebar-link">SortedCompositeImageBuilder</a><strong class="sidebar-title">Rendering/Painter</strong><a href="LineChartPainter.html" class="sidebar-link">LineChartPainter</a></div>
</aside>
    </div>
  </div>
</div>

    <footer id="footer" class="wrapper">
  <div class="inner">
    <div id="footer-copyright">
      &copy; 2016 <a href="http://www.kitware.com" target="_blank">Kitware Inc.</a>
    </div>
    <div id="footer-links">
      <a href="https://github.com/kitware/paraviewweb" class="footer-link" target="_blank"><i class="fa fa-github-alt"></i></a>
    </div>
  </div>
</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <a href="/paraviewweb/docs/" class="mobile-nav-link">Docs</a><a href="/paraviewweb/api/" class="mobile-nav-link">API</a><a href="/paraviewweb/examples/" class="mobile-nav-link">Examples</a><a href="/paraviewweb/applications/" class="mobile-nav-link">Applications</a>
      <li class="mobile-nav-item">
        <a href="https://github.com/kitware/paraviewweb" class="mobile-nav-link" rel="external" target="_blank">GitHub</a>
      </li>
    </ul>
    
      <strong class="mobile-nav-title">Common/Core</strong><a href="CompositeClosureHelper.html" class="mobile-nav-link">CompositeClosureHelper</a><a href="LookupTable.html" class="mobile-nav-link">LookupTable</a><a href="LookupTableManager.html" class="mobile-nav-link">LookupTableManager</a><strong class="mobile-nav-title">Common/Misc</strong><a href="CanvasOffscreenBuffer.html" class="mobile-nav-link">CanvasOffscreenBuffer</a><a href="Convert.html" class="mobile-nav-link">Convert</a><a href="ConvertProxyProperty.html" class="mobile-nav-link">ConvertProxyProperty</a><a href="Debounce.html" class="mobile-nav-link">Debounce</a><a href="ImageExporter.html" class="mobile-nav-link">ImageExporter</a><a href="Loop.html" class="mobile-nav-link">Loop</a><a href="Observable.html" class="mobile-nav-link">Observable</a><a href="PingPong.html" class="mobile-nav-link">PingPong</a><a href="SizeHelper.html" class="mobile-nav-link">SizeHelper</a><a href="TimeProbeManager.html" class="mobile-nav-link">TimeProbeManager</a><a href="Validate.html" class="mobile-nav-link">Validate</a><a href="WebGl.html" class="mobile-nav-link">WebGl</a><strong class="mobile-nav-title">Common/State</strong><a href="EqualizerState.html" class="mobile-nav-link">EqualizerState</a><a href="PipelineState.html" class="mobile-nav-link">PipelineState</a><a href="ToggleState.html" class="mobile-nav-link">ToggleState</a><strong class="mobile-nav-title">IO/Core</strong><a href="CSVReader.html" class="mobile-nav-link">CSVReader</a><a href="DataManager.html" class="mobile-nav-link">DataManager</a><a href="GeometryDataModel.html" class="mobile-nav-link">GeometryDataModel</a><a href="ProcessLauncher.html" class="mobile-nav-link">ProcessLauncher</a><a href="QueryDataModel.html" class="mobile-nav-link">QueryDataModel</a><strong class="mobile-nav-title">IO/Girder</strong><a href="CoreEndpoints.html" class="mobile-nav-link">CoreEndpoints</a><a href="GirderClientBuilder.html" class="mobile-nav-link">GirderClientBuilder</a><strong class="mobile-nav-title">IO/WebSocket</strong><a href="AutobahnConnection.html" class="mobile-nav-link">AutobahnConnection</a><a href="BinaryImageStream.html" class="mobile-nav-link">BinaryImageStream</a><a href="ParaViewWebClient.html" class="mobile-nav-link">ParaViewWebClient</a><a href="SmartConnect.html" class="mobile-nav-link">SmartConnect</a><strong class="mobile-nav-title">InfoViz/Core</strong><a href="D3MultiClick.html" class="mobile-nav-link">D3MultiClick</a><a href="FieldProvider.html" class="mobile-nav-link">FieldProvider</a><a href="Histogram1DProvider.html" class="mobile-nav-link">Histogram1DProvider</a><a href="Histogram2DProvider.html" class="mobile-nav-link">Histogram2DProvider</a><a href="HistogramBinHoverProvider.html" class="mobile-nav-link">HistogramBinHoverProvider</a><a href="LegendProvider.html" class="mobile-nav-link">LegendProvider</a><a href="MutualInformationProvider.html" class="mobile-nav-link">MutualInformationProvider</a><a href="SelectionProvider.html" class="mobile-nav-link">SelectionProvider</a><strong class="mobile-nav-title">InfoViz/Native</strong><a href="FieldSelector.html" class="mobile-nav-link">FieldSelector</a><a href="HistogramSelector.html" class="mobile-nav-link current">HistogramSelector</a><a href="MutualInformationDiagram.html" class="mobile-nav-link">MutualInformationDiagram</a><a href="ParallelCoordinates.html" class="mobile-nav-link">ParallelCoordinates</a><strong class="mobile-nav-title">Interaction/Core</strong><a href="MouseHandler.html" class="mobile-nav-link">MouseHandler</a><a href="VtkWebMouseListener.html" class="mobile-nav-link">VtkWebMouseListener</a><strong class="mobile-nav-title">NativeUI/Canvas</strong><a href="GaussianPieceWiseEditor.html" class="mobile-nav-link">GaussianPieceWiseEditor</a><a href="LinearPieceWiseEditor.html" class="mobile-nav-link">LinearPieceWiseEditor</a><a href="RemoteRenderer.html" class="mobile-nav-link">RemoteRenderer</a><strong class="mobile-nav-title">NativeUI/Renderers</strong><a href="NativeImageRenderer.html" class="mobile-nav-link">NativeImageRenderer</a><strong class="mobile-nav-title">React/CollapsibleControls</strong><a href="CollapsibleControlFactory.html" class="mobile-nav-link">CollapsibleControlFactory</a><a href="FloatImageControl.html" class="mobile-nav-link">FloatImageControl</a><a href="LightControl.html" class="mobile-nav-link">LightControl</a><a href="LookupTableManagerControl.html" class="mobile-nav-link">LookupTableManagerControl</a><a href="MultiViewControl.html" class="mobile-nav-link">MultiViewControl</a><a href="PixelOperatorControl.html" class="mobile-nav-link">PixelOperatorControl</a><a href="PlotlyChartControl.html" class="mobile-nav-link">PlotlyChartControl</a><a href="ProbeControl.html" class="mobile-nav-link">ProbeControl</a><a href="QueryDataModelControl.html" class="mobile-nav-link">QueryDataModelControl</a><a href="TimeFloatImageControl.html" class="mobile-nav-link">TimeFloatImageControl</a><a href="VolumeControl.html" class="mobile-nav-link">VolumeControl</a><strong class="mobile-nav-title">React/Properties</strong><a href="CellProperty.html" class="mobile-nav-link">CellProperty</a><a href="CheckboxProperty.html" class="mobile-nav-link">CheckboxProperty</a><a href="EnumProperty.html" class="mobile-nav-link">EnumProperty</a><a href="MapProperty.html" class="mobile-nav-link">MapProperty</a><a href="PropertyFactory.html" class="mobile-nav-link">PropertyFactory</a><a href="PropertyPanel.html" class="mobile-nav-link">PropertyPanel</a><a href="SliderProperty.html" class="mobile-nav-link">SliderProperty</a><strong class="mobile-nav-title">React/Renderers</strong><a href="GeometryRenderer.html" class="mobile-nav-link">GeometryRenderer</a><a href="ImageRenderer.html" class="mobile-nav-link">ImageRenderer</a><a href="MultiLayoutRenderer.html" class="mobile-nav-link">MultiLayoutRenderer</a><a href="PlotlyRenderer.html" class="mobile-nav-link">PlotlyRenderer</a><a href="VtkRenderer.html" class="mobile-nav-link">VtkRenderer</a><strong class="mobile-nav-title">React/Viewers</strong><a href="AbstractViewerMenu.html" class="mobile-nav-link">AbstractViewerMenu</a><a href="ChartViewer.html" class="mobile-nav-link">ChartViewer</a><a href="GeometryViewer.html" class="mobile-nav-link">GeometryViewer</a><a href="ImageBuilderViewer.html" class="mobile-nav-link">ImageBuilderViewer</a><a href="LineChartViewer.html" class="mobile-nav-link">LineChartViewer</a><a href="MultiLayoutViewer.html" class="mobile-nav-link">MultiLayoutViewer</a><a href="Probe3DViewer.html" class="mobile-nav-link">Probe3DViewer</a><strong class="mobile-nav-title">React/Widgets</strong><a href="ActionListWidget.html" class="mobile-nav-link">ActionListWidget</a><a href="ButtonSelectorWidget.html" class="mobile-nav-link">ButtonSelectorWidget</a><a href="CollapsibleWidget.html" class="mobile-nav-link">CollapsibleWidget</a><a href="ColorByWidget.html" class="mobile-nav-link">ColorByWidget</a><a href="ColorMapEditorWidget.html" class="mobile-nav-link">ColorMapEditorWidget</a><a href="ColorPickerWidget.html" class="mobile-nav-link">ColorPickerWidget</a><a href="CompositePipelineWidget.html" class="mobile-nav-link">CompositePipelineWidget</a><a href="ContentEditableWidget.html" class="mobile-nav-link">ContentEditableWidget</a><a href="Coordinate2DWidget.html" class="mobile-nav-link">Coordinate2DWidget</a><a href="DoubleSliderWidget.html" class="mobile-nav-link">DoubleSliderWidget</a><a href="DropDownWidget.html" class="mobile-nav-link">DropDownWidget</a><a href="EqualizerWidget.html" class="mobile-nav-link">EqualizerWidget</a><a href="FileBrowserWidget.html" class="mobile-nav-link">FileBrowserWidget</a><a href="GitTreeWidget.html" class="mobile-nav-link">GitTreeWidget</a><a href="InlineToggleButtonWidget.html" class="mobile-nav-link">InlineToggleButtonWidget</a><a href="LayoutsWidget.html" class="mobile-nav-link">LayoutsWidget</a><a href="LookupTableWidget.html" class="mobile-nav-link">LookupTableWidget</a><a href="NumberInputWidget.html" class="mobile-nav-link">NumberInputWidget</a><a href="NumberSliderWidget.html" class="mobile-nav-link">NumberSliderWidget</a><a href="PieceWiseFunctionEditorWidget.html" class="mobile-nav-link">PieceWiseFunctionEditorWidget</a><a href="PresetListWidget.html" class="mobile-nav-link">PresetListWidget</a><a href="ProxyEditorWidget.html" class="mobile-nav-link">ProxyEditorWidget</a><a href="ProxyPropertyGroupWidget.html" class="mobile-nav-link">ProxyPropertyGroupWidget</a><a href="QueryDataModelWidget.html" class="mobile-nav-link">QueryDataModelWidget</a><a href="ResplendentWidget.html" class="mobile-nav-link">ResplendentWidget</a><a href="ScalarRangeWidget.html" class="mobile-nav-link">ScalarRangeWidget</a><a href="SvgIconWidget.html" class="mobile-nav-link">SvgIconWidget</a><a href="TextInputWidget.html" class="mobile-nav-link">TextInputWidget</a><a href="ToggleIconButtonWidget.html" class="mobile-nav-link">ToggleIconButtonWidget</a><a href="TogglePanelWidget.html" class="mobile-nav-link">TogglePanelWidget</a><strong class="mobile-nav-title">Rendering/Chart</strong><a href="PlotlyChartBuilder.html" class="mobile-nav-link">PlotlyChartBuilder</a><strong class="mobile-nav-title">Rendering/Geometry</strong><a href="ThreeGeometryBuilder.html" class="mobile-nav-link">ThreeGeometryBuilder</a><strong class="mobile-nav-title">Rendering/Image</strong><a href="AbstractImageBuilder.html" class="mobile-nav-link">AbstractImageBuilder</a><a href="BinaryDataProberImageBuilder.html" class="mobile-nav-link">BinaryDataProberImageBuilder</a><a href="CompositeImageBuilder.html" class="mobile-nav-link">CompositeImageBuilder</a><a href="DataProberImageBuilder.html" class="mobile-nav-link">DataProberImageBuilder</a><a href="DepthCompositeImageBuilder.html" class="mobile-nav-link">DepthCompositeImageBuilder</a><a href="DepthImageBuilder.html" class="mobile-nav-link">DepthImageBuilder</a><a href="FloatDataImageBuilder.html" class="mobile-nav-link">FloatDataImageBuilder</a><a href="FloatTimeDataImageBuilder.html" class="mobile-nav-link">FloatTimeDataImageBuilder</a><a href="MagicLensImageBuilder.html" class="mobile-nav-link">MagicLensImageBuilder</a><a href="MultiColorBySortedCompositeImageBuilder.html" class="mobile-nav-link">MultiColorBySortedCompositeImageBuilder</a><a href="PixelOperatorImageBuilder.html" class="mobile-nav-link">PixelOperatorImageBuilder</a><a href="QueryDataModelImageBuilder.html" class="mobile-nav-link">QueryDataModelImageBuilder</a><a href="SortedCompositeImageBuilder.html" class="mobile-nav-link">SortedCompositeImageBuilder</a><strong class="mobile-nav-title">Rendering/Painter</strong><a href="LineChartPainter.html" class="mobile-nav-link">LineChartPainter</a>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>English</span></span>
    <select id="mobile-lang-select" data-canonical="api/HistogramSelector.html">
      
        <option value="en" selected>English</option>
      
    </select>
  </div>
</nav>
  <!-- Scripts -->
<!-- build:js build/js/main.js -->
<script src="/paraviewweb/js/lang_select.js"></script>
<script src="/paraviewweb/js/toc.js"></script>
<script src="/paraviewweb/js/mobile_nav.js"></script>
<!-- endbuild -->
<script src="https://cdn.jsdelivr.net/retinajs/1.3.0/retina.min.js" async></script>



</body>
</html>